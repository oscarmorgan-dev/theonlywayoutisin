<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Portfolio Landing Page</title>
    <link href="https://fonts.googleapis.com/css2?family=KH+Teka:wght@400&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'MonumentGrotesk-Semi-Mono';
            src: local('MonumentGrotesk-Semi-Mono'), local('Monument Grotesk Semi Mono'), url('MonumentGrotesk-Semi-Mono.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }

        /* Alias to match requested family name exactly */
        @font-face {
            font-family: 'Monument Semi Grotesk';
            src: local('MonumentGrotesk-Semi-Mono'), local('Monument Semi Grotesk'), url('MonumentGrotesk-Semi-Mono.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Sigurd';
            src: url('fonnts.com-Sigurd-Variable-Light.otf') format('opentype');
            font-weight: 300;
            font-style: normal;
        }

        @font-face {
            font-family: 'Minion Pro';
            src: url('Minion3-Regular.otf') format('opentype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Minion Pro';
            src: url('Minion3-Bold.otf') format('opentype');
            font-weight: 700;
            font-style: normal;
        }

        @font-face {
            font-family: 'Minion Pro';
            src: url('Minion3-Italic.otf') format('opentype');
            font-weight: 400;
            font-style: italic;
        }

        @font-face {
            font-family: 'Tratatello';
            src: url('tratatello.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'P22 Operina Pro';
            src: url('P22 Operina Pro Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Minion3 Regular';
            src: url('Minion3-Regular.otf') format('opentype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Sabbath Black';
            src: url('Sabbath-Black Black.ttf') format('truetype');
            font-weight: 900;
            font-style: normal;
        }

        @font-face {
            font-family: 'KHTeka-Regular';
            src: url('KHTeka-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }
        :root { --side-margin: 80px; --content-pad: 40px; --pellet-bg: rgba(255,255,255,0.75); --pellet-border: #333; --pellet-font-size: 16px; --pellet-line: 1.1; --pellet-maxw: 66%; }
        /* Pellet token (shared styles) */
        .text-panel .pellet {
          padding: 8px 14px;
          border-radius: 999px;
          background: var(--pellet-bg);
          border: 2px solid var(--pellet-border);
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.40),
            inset 0 -1px 0 rgba(0,0,0,0.12),
            0 2px 10px rgba(0,0,0,0.08);
          backdrop-filter: blur(6px) saturate(1.05);
          -webkit-backdrop-filter: blur(6px) saturate(1.05);
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          font-size: var(--pellet-font-size);
          line-height: var(--pellet-line);
          color: #000; letter-spacing: 0.01em; text-align: left;
          width: fit-content; max-width: var(--pellet-maxw);
          white-space: normal; overflow-wrap: anywhere; user-select: none;
        }
        /* Performance optimization: Disable expensive filters on mobile */
        @media (max-width: 768px) {
          .text-panel .pellet {
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
          }
        }
        /* Remove stroke on all pellets */
        .text-panel .hud-pellet,
        .text-panel .square-pellet,
        .text-panel .video-pellet,
        .text-panel .black-pellet { border: none !important; }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html, body { height: 100%; overflow: hidden; }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #fff; /* explicit white background */
        }

        /* Unified hero architecture */
        .hero { position: fixed; inset: 0; height: 100vh; width: 100vw; overflow: hidden; z-index: 1; touch-action: none; -webkit-transform: translateZ(0); transform: translateZ(0); }
        .bg {
            position: absolute;
            top: 0; left: var(--side-margin); right: var(--side-margin);
            will-change: transform;
            pointer-events: none;
        }
        .bg .background-block { height: 100vh; }
        .bg .background-block img { width: 100%; height: 100%; object-fit: cover; object-position: center; display: block; }

        /* Show more of the top of the very first image */
        .bg .background-block:first-child img {
          object-position: 50% 15%;
        }

        /* On smaller screens, favour the top even more */
        @media (max-width: 768px) {
          .bg .background-block:first-child img { object-position: 50% 10%; }
        }
        @media (max-width: 480px) {
          .bg .background-block:first-child img { object-position: 50% 8%; }
        }

        @media (max-width: 768px) {
          .hero { height: 100svh; }
          .bg .background-block { height: 100svh; }
          .left-margin,
          .right-margin { height: 100svh; }
        }
        .background-separator { height: 28px; background: #fff; border-top: 2px solid #333; border-bottom: 2px solid #333; }

        /* Footer pointer events */
        .footer-panel { pointer-events: none; }
        .footer-panel .final-text-overlay,
        .footer-panel a,
        .footer-panel button,
        .final-navigation-links { pointer-events: auto; }

        /* Left Margin with Ruler */
        .left-margin {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--side-margin);
            height: 100vh;
            pointer-events: none;
            background-color: white;
            z-index: 999;
            border-right: 2px solid #333;
        }

        /* Right Margin */
        .right-margin {
            position: fixed;
            right: 0;
            top: 0;
            width: var(--side-margin);
            height: 100vh;
            pointer-events: none;
            background-color: white;
            z-index: 999;
            border-left: 2px solid #333;
        }




        /* Fixed Navigation Bar */
        .nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 28px; /* Reverted to previous desktop size */
            background-color: white; /* White background */
            border-bottom: 2px solid #333; /* Thin black bottom border matching margins */
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between; /* Space between left, center, and right elements */
            padding: 0 20px;
        }

        .nav-text {
            font-family: 'KH Teka', Arial, sans-serif;
            font-weight: 400;
            color: black; /* Black text */
            font-size: 16px; /* Match text overlay benchmark */
            margin: 0;
        }

        /* Simple nav music player centered in app bar */
        .nav-player{
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
          display: inline-flex;
          align-items: center;
          gap: 8px;
          height: 28px; /* match bar height */
          line-height: 28px;
          font-family: 'KH Teka', system-ui, -apple-system, Arial, sans-serif;
          font-size: 12px; /* match intro button size */
          color: #000;
          white-space: nowrap;
        }
        .nav-player .label{ opacity: 0.9; }
        .nav-player .track{ font-weight: 400; }
        .nav-player button.nav-mute{
          appearance: none; -webkit-appearance: none;
          border: none; background: transparent; color: #000; cursor: pointer;
          padding: 0; margin: 0; font: inherit; line-height: inherit;
          position: relative;
        }
        .nav-player button.nav-mute:focus{ outline: none; }
        /* Underline animation matching intro buttons */
        .nav-player button.nav-mute::after{
          content: "";
          position: absolute;
          left: 0; right: 0; bottom: 7px;
          width: 100%; height: 1px; background: currentColor;
          transform: scaleX(0);
          transform-origin: left center;
          opacity: 0;
          transition: transform 240ms cubic-bezier(0.2, 0.6, 0.15, 1), opacity 160ms ease;
          will-change: transform, opacity;
        }
        .nav-player button.nav-mute:hover::after,
        .nav-player button.nav-mute:focus-visible::after{ transform: scaleX(1); opacity: 1; }
        .nav-player button.nav-mute:active::after{ animation: underlineClick 180ms ease-out; }

        .nav-depth-counter {
            font-family: 'KH Teka', Arial, sans-serif;
            font-weight: 400;
            color: black; /* Black text */
            font-size: 16px; /* Match text overlay benchmark */
            margin: 0;
            font-variant-numeric: tabular-nums; /* prevents jitter when numbers change */
        }


        .background-block {
            width: 100%;
            display: block;
        }


        /* Ensure no gaps between images */
        .background-block:not(:last-child) {
            margin-bottom: 0;
        }

        /* White separator between background images */
        

        /* Unified scroll source: text panel */
        .text-panel {
            position: absolute;
            left: 50%; transform: translateX(-50%);
            top: 10vh; width: 48%; max-width: 640px; height: 80vh;
            background: rgba(255,255,255,0.95);
            border: 2px solid #333; padding: var(--content-pad); overflow-y: auto; overflow-x: hidden;
            backdrop-filter: blur(5px); box-shadow: 0 10px 30px rgba(0,0,0,.3);
            overscroll-behavior: contain;
            z-index: 2;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            /* Mobile performance optimizations */
            -webkit-transform: translateX(-50%) translateZ(0);
            transform: translateX(-50%) translateZ(0);
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        .text-panel p { font-family: 'KH Teka', Arial, sans-serif; font-size: 16px; line-height: 1.28; color:#333; margin-bottom:20px; text-align: justify; hyphens: auto; }
        .text-panel img { width: 50%; max-width: 200px; height: auto; display:block; margin: 30px auto; }
        /* Override justification for intro module text */
        .text-panel .section-01 .intro-subtext{ text-align: left !important; text-align-last: left !important; hyphens: none !important; -webkit-hyphens: none !important; }

        /* Image boxes and separators */
        .image-box {
          height: 500px;
          display: flex;
          align-items: center;
          justify-content: center;
          overflow: hidden;
            border: 2px solid #333;
          box-sizing: border-box;
          margin-bottom: 40px;
        }

        .image-box img,
        .small-image-box img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          object-position: center;
          display: block;
          margin: 0;
          max-width: none;
        }

        .image-separator {
          height: 28px;
          background: #fff;
          border-top: 2px solid #333;
          border-bottom: 2px solid #333;
          box-sizing: border-box;
        }

        /* Natural aspect ratio boxes for journey images */
        .image-box-natural {
          height: auto;
          min-height: 200px;
          padding: 0;
          border: 2px solid #333;
          box-sizing: border-box;
          margin-bottom: 40px;
        }

        /* Half-width variant for post-HUD image */
        .text-panel .image-box-natural.half { width: 50%; margin-left: auto; margin-right: auto; }

        .image-box-natural img {
          width: 100%;
            height: auto;
          object-fit: contain;
            display: block;
          margin: 0 auto;
        }

        /* Small 300x300 image boxes */
        .small-image-box {
          width: 300px;
          height: 300px;
          display: block;
          margin: 0 auto 40px auto;
          border: 2px solid #333;
          box-sizing: border-box;
          background: transparent;
          overflow: hidden;
        }


        /* Remove bottom margin from last image box */
        .image-box:last-child,
        .image-box-natural:last-child,
        .small-image-box:last-child {
          margin-bottom: 0;
        }

        /* Title image styling */
        .title-image {
          display: flex;
          justify-content: center;
          align-items: flex-start;
          margin-bottom: 40px;
          padding: 0 var(--side-margin);
        }

        .title-image img {
          width: 300px;
          height: auto;
          display: block;
        }

        /* Title text styling */
        .title-text {
          margin-bottom: 40px;
          text-align: center;
        }
        
        /* Hero intro text box under top cube */
        .hero-text-box {
          border: 2px solid #333;
          background: #fff;
          padding: calc(var(--content-pad) * 0.8) var(--content-pad); /* reduce height ~20% */
          margin: 16px 0 0 0;
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.50),
            inset 0 -1px 0 rgba(0,0,0,0.18),
            0 2px 12px rgba(0,0,0,0.08);
        }
        .hero-text-box p { font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-size: 11.2px; line-height: 0.9; color:#333; margin: 0; text-align: center; }
        .hero-spacer { height: 28px; }
        /* word-by-word fade-up rollout for hero title */
        .hero-text { line-height: 1.152; transform: translateY(-20%); }
        .hero-word { display: inline-block; opacity: 0; filter: blur(4px); animation: heroWordIn .267s ease-out forwards; animation-delay: var(--d, 0s); margin-right: 0.25em; }
        @keyframes heroWordIn { to { opacity: 1; filter: blur(0); } }
        @media (prefers-reduced-motion: reduce) { .hero-word { opacity: 1; filter: none; animation: none; } }

        /* Hero CTA button */
        .hero-cta {
          display: block;
          margin: 8px auto 0 auto;
          padding: 0;
          border: none;
          background: transparent;
          color: #000;
          text-decoration: none;
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          font-size: 11.2px;
          line-height: 0.9;
          cursor: pointer;
        }

        /* Hero action buttons */
        .hero-actions { display:flex; justify-content:center; align-items:center; gap:12px; margin-top: 12px; }
        .hero-btn {
          display:inline-block; text-decoration:none; cursor:pointer;
          padding: 8px 14px; border: 2px solid #333; background:#000; color:#fff;
          font-family: 'KH Teka', Arial, sans-serif; font-size: 11.2px; line-height: 0.9;
        }

        /* Title for strategy section (kept, no grid) */
        .text-panel .tv-title {
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          font-size: 11.2px; /* 30% smaller than 16px */
          line-height: 0.9;
          color: #333;
          margin: 16px 0 8px 0;
          text-align: center;
        }

        .title-text p {
          font-family: 'KH Teka', Arial, sans-serif;
          font-size: 16px;
          line-height: 1.0;
          color: #333;
          margin-bottom: 20px;
          text-align: center;
        }

        .title-credit {
          font-family: 'KH Teka', Arial, sans-serif;
          font-size: 16px;
          line-height: 1.0;
          color: #333;
          text-align: center;
          margin-bottom: 0;
        }




        /* Two-column text overlay on last image */
        .final-text-overlay {
          /* remove absolute layout */
          position: static;
          left: auto; bottom: auto; transform: none;
          /* centered measure */
          width: clamp(320px, 72vw, 960px);
          max-width: 960px;
          margin: 0 auto 24px auto;

          display: grid;
          grid-template-columns: 1fr 1fr; /* two columns on desktop */
          gap: 40px;
          z-index: auto; /* no stacking tricks needed */
          padding-inline: var(--content-pad);
        }
        .final-text-column { /* keep the wrapper, normal flow */
          display: block;
        }
        .final-text-overlay p {
            font-family: 'KH Teka', Arial, sans-serif;
            font-size: 16px;
          line-height: 1.28;
          color: #000;           /* black text in footer */
          margin: 0 0 16px 0;
          text-align: left;
          text-shadow: none;     /* remove overlay shadow */
            hyphens: auto;
        }

        /* Footer slides in when the text finishes */
        .footer-panel {
          position: fixed;
          top: 100vh;
          left: var(--side-margin);
          right: var(--side-margin);
          height: 100vh;
          background: #fff;
          z-index: 1;
          transition: transform .6s ease;
          padding: 80px 0;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          overflow: hidden; /* ensure nothing spills outside */
          will-change: transform;
        }
        .footer-panel.show { transform: translateY(-100vh); }

        @media (prefers-reduced-motion: reduce) {
          .footer-panel { transition: none; }
        }

        /* Remove old duplicates (no explicit display none for text overlay anymore) */

        /* Navigation links below final text */
        .final-navigation-links {
          position: static; left: auto; bottom: auto; transform: none;
          width: clamp(320px, 72vw, 960px);
          max-width: 960px;
          margin: 12px auto 0 auto;

          display: flex;
          justify-content: center;
          align-items: center;
          gap: 24px;
          flex-wrap: wrap;
          padding-inline: var(--content-pad);
          font-size: 16px;
        }
        .final-navigation-links a {
          font-family: 'KH Teka', Arial, sans-serif;
          font-size: inherit;   /* inherit from container */
          color: #000;            /* black links in footer */
          text-decoration: none;
          text-shadow: none;
        }
        .final-navigation-links a:hover { text-decoration: none; }





        /* === HUD demo (scoped to text panel) === */
        .text-panel .hud-slot {
          position: relative;
          width: 60%;
          height: auto;
          aspect-ratio: 1 / 1; /* make square */
          overflow: hidden;
          background: rgba(255,255,255,0.02);
          margin: 12px auto var(--content-pad) auto; /* center */
          border: 2px solid #333; /* match site frame width */
          /* glassy embossed edge */
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.50), /* top highlight */
            inset 0 -1px 0 rgba(0,0,0,0.18),      /* bottom shadow */
            0 2px 12px rgba(0,0,0,0.08);          /* soft outer glow */
          box-sizing: border-box;
        }
        .text-panel .hud-layer { position: absolute; inset: 0; }
        .text-panel .hud-grid { background-image:
            repeating-linear-gradient(to right, rgba(0,0,0,0.12) 0 1px, transparent 1px 16px),
            repeating-linear-gradient(to bottom, rgba(0,0,0,0.12) 0 1px, transparent 1px 16px);
          opacity: .35; }
        .text-panel .hud-images { filter: blur(10px); }
        .text-panel .hud-images img { position: absolute; object-fit: cover; display: block; opacity: .9; }
        .text-panel .hud-bitmap { filter: contrast(1.2) saturate(1.1); opacity: .6; }
        .text-panel .hud-micro img { position: absolute; object-fit: fill; display: block; box-shadow: 0 6px 14px rgba(0,0,0,.10); }
        .text-panel .hud-micro-label {
          position: absolute;
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          font-size: 10px;
          line-height: 1;
          color: #000;
          letter-spacing: 0.02em;
          pointer-events: none;
          opacity: 0;
        }
        .text-panel .hud-threshold { pointer-events:none; background: rgba(255,255,255,0.12); mix-blend-mode: screen; backdrop-filter: contrast(1.6) saturate(1.4) brightness(1.25); }
        /* Performance optimization: Disable expensive filters on mobile */
        @media (max-width: 768px) {
          .text-panel .hud-threshold { backdrop-filter: none; -webkit-backdrop-filter: none; }
        }
        .text-panel .hud-overlay { pointer-events: none; }
        .text-panel .hud-rect { position:absolute; border:1px solid #ef4136; }
        .text-panel .hud-label { position:absolute; font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-size: 8.4px; color: #000; }
        .text-panel .hud-label.top-left { top: 8px; left: 8px; }
        .text-panel .hud-label.bottom-left { bottom: 8px; left: 8px; }
        .text-panel .hud-label.bottom-right { bottom: 8px; right: 8px; }
        .text-panel .hud-lines { position:absolute; inset:0; width:100%; height:100%; display:block; }
        .text-panel .hud-lines line { stroke: rgb(0, 255, 0); stroke-width:1; opacity:1; vector-effect: non-scaling-stroke; shape-rendering: crispEdges; stroke-linecap: square; }
        .text-panel .hud-lines line.cross { stroke-dasharray:3 3; opacity:1; }
        /* Glassy pellet overlay for HUD title */
        .text-panel .hud-pellet { display: none !important; }
        .text-panel .hud-caption {
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          font-size: 11.2px; line-height: 0.9; color: #333; letter-spacing: 0;
          width: 60%;
          margin: 6px auto var(--content-pad) auto; /* aligns with frame width and center */
          text-align: left;
          transform: translateY(-20%); /* move 20% upward toward frame */
        }
        /* Static glassy grid frame */
        .text-panel .glass-frame {
          position: relative;
          width: 100%;
          height: 36vh;
          max-height: 420px;
          min-height: 180px;
          margin: 8px 0 var(--content-pad) 0;
          background: #fff;
          overflow: hidden;
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.50),
            inset 0 -1px 0 rgba(0,0,0,0.18),
            0 2px 12px rgba(0,0,0,0.08);
        }
        .text-panel .glass-frame .grid { position:absolute; inset:0; background-image:
            repeating-linear-gradient(to right, rgba(255,255,255,0.12) 0 1px, transparent 1px 16px),
            repeating-linear-gradient(to bottom, rgba(255,255,255,0.12) 0 1px, transparent 1px 16px); opacity:.35; }

        /* Code typing animation */
        .text-panel .code-anim {
          position: relative;
          width: 100%;
          margin: 8px 0 var(--content-pad) 0;
          background: #fff;
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.50),
            inset 0 -1px 0 rgba(0,0,0,0.18),
            0 2px 12px rgba(0,0,0,0.08);
        }
        .text-panel .code-overlay {
          position: absolute; inset: 0;
          display: flex; align-items: center; justify-content: center;
          pointer-events: none;
          animation: none;
          opacity: 1;
        }
        .text-panel .code-overlay img { max-width: 100%; max-height: 252px; width: auto; height: auto; display: block; object-fit: contain; box-shadow: 0 6px 14px rgba(0,0,0,.12); }
        @keyframes fadeOverlay { from { opacity: 0.0; } to { opacity: 0.6; } }
        .text-panel .code-screen {
          color: #000;
          text-shadow: none;
          background: transparent;
          padding: 20px;
          height: 403px; /* 60% increase from 252px */
          overflow: hidden; /* hide scrollbar; programmatic scroll still works */
          -ms-overflow-style: none; /* IE/Edge */
          scrollbar-width: none;     /* Firefox */
          white-space: pre-wrap;
          font-family: 'MonumentGrotesk-Semi-Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
          font-size: 12px;
          line-height: 1.35;
          filter: blur(1px);
        }
        .text-panel .code-screen::-webkit-scrollbar { display: none; }
        .text-panel .code-threshold { position:absolute; inset:0; pointer-events:none; background: rgba(255,255,255,0.10); mix-blend-mode: screen; backdrop-filter: contrast(1.4) saturate(1.2) brightness(1.15); }
        /* Performance optimization: Disable expensive filters on mobile */
        @media (max-width: 768px) {
          .text-panel .code-threshold { backdrop-filter: none; -webkit-backdrop-filter: none; }
        }
        .text-panel .hud-rect-label { position:absolute; left:2px; bottom:2px; font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-size: 8.4px; color:#000; line-height:1; pointer-events:none; }

        /* Vector diagram animation */
        .text-panel .diagram-anim { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
        .text-panel .diagram-anim svg { width: 100%; height: 100%; }
        .text-panel .diagram-anim .stroke { stroke:#000; stroke-width:1; fill:none; stroke-linecap: square; }
        .text-panel .diagram-anim .text { fill:#000; font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-size: 14px; }
        .text-panel .diagram-anim .draw { stroke-dasharray: 3000; stroke-dashoffset: 3000; animation: drawPath 2.2s ease forwards; }
        .text-panel .diagram-anim .draw.d2 { animation-delay: .4s; }
        .text-panel .diagram-anim .draw.d3 { animation-delay: .8s; }
        .text-panel .diagram-anim .draw.d4 { animation-delay: 1.2s; }
        @keyframes drawPath { to { stroke-dashoffset: 0; } }
        .text-panel .diagram-anim .dashed { stroke-dasharray: 4 4; }
        /* Breadth image + vector animation */
        .text-panel .breadth-anim { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; overflow:hidden; }
        .text-panel .breadth-anim img.ref { max-width: 88%; height:auto; opacity: .14; filter: grayscale(100%) contrast(1.1); }
        .text-panel .breadth-anim .breadth-svg { position:absolute; inset:0; display:block; }
        .text-panel .breadth-anim svg { width:100%; height:100%; display:block; }
        .text-panel .breadth-anim .stroke { stroke:#000; stroke-width:1.5; fill:none; stroke-linecap: square; vector-effect: non-scaling-stroke; }
        .text-panel .breadth-anim .dashed { stroke-dasharray: 4 6; opacity: .9; }
        .text-panel .breadth-anim .label { fill:#000; font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-size: 12px; text-shadow: none; }
        .text-panel .breadth-anim .draw { stroke-dasharray: 1600; stroke-dashoffset: 1600; animation: drawBreadth 1.8s cubic-bezier(.22,.61,.36,1) forwards; }
        .text-panel .breadth-anim .d2 { animation-delay: .18s; }
        .text-panel .breadth-anim .d3 { animation-delay: .36s; }
        .text-panel .breadth-anim .d4 { animation-delay: .54s; }
        .text-panel .breadth-anim .glow { filter: drop-shadow(0 0 2px rgba(0,0,0,.15)); }
        @keyframes drawBreadth { to { stroke-dashoffset: 0; } }
        .text-panel .code-anim.breadth-frame { position: relative; height: 360px; }
        .text-panel .breadth-anim::before, .text-panel .breadth-anim::after { content:""; position:absolute; left:50%; top:50%; width:40%; aspect-ratio:1/1; transform: translate(-50%, -50%) scale(0.35); border-radius:50%; border:1px solid #000; opacity:.12; pointer-events:none; animation: ripple 3.6s ease-out infinite; }
        .text-panel .breadth-anim::after { width:52%; opacity:.10; border-style:dashed; animation-delay: 0.9s; }
        @keyframes ripple { 0% { transform: translate(-50%, -50%) scale(0.35); opacity:.16; } 100% { transform: translate(-50%, -50%) scale(2.2); opacity:0; } }
        @media (prefers-reduced-motion: reduce) {
          .text-panel .breadth-anim .draw { animation: none; stroke-dashoffset: 0; }
          .text-panel .breadth-anim::before, .text-panel .breadth-anim::after { animation: none; opacity: 0; }
        }
        /* Square frame with pellet overlay */
        .text-panel .square-frame {
          position: relative;
          width: 60%;
          height: auto;
          aspect-ratio: 1 / 1; /* match HUD square */
          border: 2px solid #333; /* same frame width */
          background: rgba(255,255,255,0.02); /* glassy base */
          overflow: hidden;
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.50), /* top highlight */
            inset 0 -1px 0 rgba(0,0,0,0.18),      /* bottom shadow */
            0 2px 12px rgba(0,0,0,0.08);          /* soft outer glow */
          box-sizing: border-box;
          margin: 12px auto var(--content-pad) auto; /* center, same spacing */
          perspective: 1000px;
        }
        .text-panel .square-frame .square-img {
          position: absolute; inset: 0;
          display: flex; align-items: center; justify-content: center;
          transform-style: preserve-3d;
          pointer-events: none;
        }
        .text-panel .square-frame .square-img img {
          max-width: 90%; max-height: 90%; width: auto; height: auto; object-fit: contain; display: block;
          filter: none; opacity: 1;
        }
        .text-panel .square-frame .square-pellet {
          position: absolute;
          top: 30%; left: 12px; transform: translateY(-50%);
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-weight: 400;
          font-size: 11.2px; line-height: 1.0; color: #fff; letter-spacing: 0;
          background: #000; border: none; box-shadow: none; padding: 8px 14px; border-radius: 0;
          text-align: left; max-width: 80%; white-space: normal; overflow-wrap: anywhere;
          user-select: none; pointer-events: none; z-index: 2;
        }

        /* Process animation (three spheres) */
        .text-panel .process-frame {
          position: relative;
          width: 60%;
          height: auto;
          aspect-ratio: 16 / 9;
          border: none;
          background: transparent;
          overflow: hidden;
          box-shadow: none;
          box-sizing: border-box;
          margin: 12px auto var(--content-pad) auto; /* neat padding in textPanel */
        }
        .text-panel .process-spheres { position:absolute; inset:0; }
        .text-panel .sphere {
          position: absolute; width: 72px; height: 72px; border-radius: 50%;
          background: #fff;
          border: 2px solid #333;
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.50),
            inset 0 -1px 0 rgba(0,0,0,0.18);
          opacity: 1;
          will-change: transform, opacity;
        }
        .text-panel .sphere .sphere-label { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-size: 11.2px; line-height:1; color:#000; text-align:center; pointer-events:none; }
        .text-panel .sphere--ring { width: 64px; height: 64px; }
        .text-panel .ring-nodes { position:absolute; inset:0; }
        

        /* Video frame styled like HUD/square frame */
        .text-panel .video-frame {
          position: relative;
          width: 78%; /* 30% wider than 60% */
          height: auto;
          aspect-ratio: 16 / 9; /* 16:9 video */
          border: 2px solid #333;
          background: #000; /* avoid light seam on subpixel edges */
          overflow: hidden;
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.50),
            inset 0 -1px 0 rgba(0,0,0,0.18),
            0 2px 12px rgba(0,0,0,0.08);
          box-sizing: border-box;
          margin: var(--content-pad) auto var(--content-pad) auto; /* comfortable padding */
        }
        .text-panel .video-frame video {
          position: absolute; inset: 0;
          /* Slight overscan to avoid subpixel seams */
          width: 102%; height: 102%;
          left: -1%; top: -1%;
          object-fit: cover; /* crop to fit */
          display: block;
          transform: translateZ(0); backface-visibility: hidden; -webkit-backface-visibility: hidden;
        }
        .text-panel .video-frame .video-pellet {
          position: absolute;
          top: 30%; left: 12px; transform: translateY(-50%);
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-weight: 400;
          font-size: 11.2px; line-height: 1.0; color: #fff; letter-spacing: 0;
          background: #000; border: none; box-shadow: none; padding: 8px 14px; border-radius: 0;
          text-align: left; max-width: 80%; white-space: normal; overflow-wrap: anywhere;
          user-select: none; pointer-events: none; z-index: 2;
        }

        /* Three small image boxes under video */
        .text-panel .thumb-row {
          width: 78%;
          margin: 12px auto var(--content-pad) auto;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 12px;
          flex-wrap: nowrap;
        }
        .text-panel .thumb-row > div { flex: 1 1 0; display: flex; flex-direction: column; align-items: center; }
        .text-panel .thumb-row .small-image-box {
          width: 100%;
          aspect-ratio: 16 / 9;
          height: auto;
          margin: 0;
          overflow: hidden;
          display: block;
          opacity: 0; /* will fade in via scroll */
          transform: translateX(-20px);
          will-change: opacity, transform;
          transition: opacity .35s ease, transform .35s ease;
          /* maintain original frame sizing */
        }
        .text-panel .thumb-row .small-image-box img {
          width: 100%; height: 100%; object-fit: cover; display: block;
        }
        .text-panel .thumb-row .small-caption {
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          font-size: 11.2px; line-height: 0.9; color:#333; text-align:center;
          margin-top: 6px; opacity: 0; transition: opacity .35s ease;
        }

        /* Black square image box with pellet (styled like other frames) */
        .text-panel .black-square-frame {
          position: relative;
          width: 60%;
          height: auto;
          aspect-ratio: 1 / 1;
          border: 2px solid #333;
          background: #000 center/cover no-repeat; /* allow full-bleed bg image */
          overflow: hidden;
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.20),
            inset 0 -1px 0 rgba(0,0,0,0.40),
            0 2px 12px rgba(0,0,0,0.08);
          box-sizing: border-box;
          margin: var(--content-pad) auto var(--content-pad) auto;
        }
        .text-panel .black-square-frame .black-pellet {
          position: absolute;
          top: 30%; left: 12px; transform: translateY(-50%);
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-weight: 400;
          font-size: 11.2px; line-height: 1.0; color: #fff; letter-spacing: 0;
          background: #000; border: none; box-shadow: none; padding: 8px 14px; border-radius: 0;
          text-align: left; max-width: 80%; white-space: normal; overflow-wrap: anywhere;
          user-select: none; pointer-events: none; z-index: 2;
        }
        .text-panel .black-square-frame .black-img { position: absolute; inset: 0; line-height: 0; }
        .text-panel .black-square-frame .black-img img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; object-position: center; display: block; transform: translateZ(0); }
        /* Ring of circles animation */
        .text-panel .ring-frame { position: relative; width: 72%; aspect-ratio: 1 / 1; margin: calc(var(--content-pad) * 0.7) auto calc(var(--content-pad) * 0.7) auto; overflow: visible; }
        .text-panel .ring-svg { position:absolute; inset:0; display:block; }
        .text-panel .ring-svg .ring-path { stroke:#333; stroke-width:2; fill:none; vector-effect: non-scaling-stroke; stroke-linecap: round; display:none; }
        .text-panel .ring-node { fill:#fff; stroke:#333; stroke-width:2; }
        .text-panel .ring-label { fill:#000; font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-size: 9.6px; text-anchor: middle; dominant-baseline: middle; alignment-baseline: middle; pointer-events: none; opacity: 0; }
        /* Flow process */
        .text-panel .flow-frame { position: relative; width: 78%; height: auto; aspect-ratio: 16 / 6; border: none; background: transparent; margin: var(--content-pad) auto var(--content-pad) auto; box-shadow: none; overflow:hidden; }
        .text-panel .flow-row { position:absolute; inset: 12px; display:flex; align-items:center; justify-content: space-between; gap: 12px; }
        .text-panel .flow-box { position:relative; flex:1 1 0; min-width:0; background:#fff; border:2px solid #333; padding:10px 12px; text-align:center; font-family:'MonumentGrotesk-Semi-Mono', Arial, sans-serif; font-size:11.2px; line-height:1; color:#000; opacity:0; transform: translateX(-16px); transition: opacity .35s ease, transform .35s ease; }
        .text-panel .flow-box:not(:last-child)::after { content:""; position:absolute; top:50%; right:-10px; transform: translateY(-50%); width:0; height:0; border-left: 10px solid #333; border-top: 6px solid transparent; border-bottom: 6px solid transparent; }
        .text-panel .flow-lines { position:absolute; inset:0; pointer-events:none; }
        .text-panel .flow-lines path { stroke:#333; stroke-width:2; fill:none; vector-effect: non-scaling-stroke; }
        /* HUD module overrides */
        .text-panel .section-hud .section-inner{ padding: 0; transform: none; }
        .text-panel .section-hud .hud-slot{ width: 100%; height: 100%; aspect-ratio: auto; margin: 0; border: none; background: transparent; box-shadow: none; }
        /* Tablet and down */
        @media (max-width: 768px) {
          :root { --side-margin: 40px; --content-pad: 24px; }
          .text-panel {
            width: min(92vw, 560px);
            top: 12svh;
            height: 76svh;
            border-width: 1.5px;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            box-shadow: 0 6px 18px rgba(0,0,0,.18);
            background: transparent !important;
            /* Optimize mobile scrolling */
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
          }
          .text-panel p { font-size: 15px; line-height: 1.3; }
          .text-panel img { width: 40%; max-width: 140px; margin: 20px auto; }
          .image-box { height: 500px; }
          .image-box img,
          .small-image-box img { width: 100%; height: 100%; margin: 0; max-width: none; object-fit: cover; object-position: center; display: block; }
          .image-box-natural { height: auto; min-height: 150px; }
          .image-box-natural img { width: 100%; height: auto; object-fit: contain; }
          .small-image-box { width: 250px; height: 250px; margin-bottom: 30px; display: block; overflow: hidden; }
          .image-box { margin-bottom: 30px; }
          .image-box-natural { margin-bottom: 30px; }
          .title-image { margin-bottom: 30px; padding: 0 var(--side-margin); }
          .title-image img { width: 250px; }
          .title-text { margin-bottom: 30px; }
          .title-text p, .title-credit { font-size: 15px; }

          /* Modules - comfortable mobile layout */
          .text-panel .section { height: 78svh; }
          .text-panel .section-inner { padding: 24px 6%; transform: translateY(-6%); }
          .section-title { font-size: 26px; }
          .section-body { font-size: 15px; line-height: 1.38; max-width: 64ch; }
          .module-number { font-size: 15px; }
          /* Module 02 uses standard responsive sizes for tablet */
          .intro-square { width: min(84vw, 420px); }
        }

        /* Small phones */
        @media (max-width: 480px) {
          :root { --side-margin: 20px; --content-pad: 16px; }
          .text-panel {
            width: 92vw;
            top: 12svh;
            height: 74svh;
            border-width: 1.5px;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            box-shadow: 0 6px 18px rgba(0,0,0,.18);
            background: transparent !important;
            /* Optimize mobile scrolling */
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            /* Prevent horizontal scroll */
            overflow-x: hidden;
          }
          .text-panel p { font-size: 14px; line-height: 1.35; }
          .text-panel img { width: 33%; max-width: 120px; margin: 16px auto; }
          .image-box { height: 500px; }
          .image-box img,
          .small-image-box img { width: 100%; height: 100%; margin: 0; max-width: none; object-fit: cover; object-position: center; display: block; }
          .image-box-natural { height: auto; min-height: 120px; }
          .image-box-natural img { width: 100%; height: auto; object-fit: contain; }
          .small-image-box { width: 200px; height: 200px; margin-bottom: 24px; display: block; overflow: hidden; }
          .image-box { margin-bottom: 24px; }
          .image-box-natural { margin-bottom: 24px; }
          .title-image { margin-bottom: 24px; padding: 0 var(--side-margin); }
          .title-image img { width: 200px; }
          .title-text { margin-bottom: 24px; }
          .title-text p, .title-credit { font-size: 14px; }

          /* Modules - small phones */
          .text-panel .section { height: 74svh; }
          .text-panel .section-inner { padding: 20px 6%; transform: translateY(-4%); }
          .section-title { font-size: 22px; letter-spacing: 0.005em; }
          .section-body { font-size: 14px; line-height: 1.4; max-width: 66ch; }
          .module-number { font-size: 14px; }
          /* Module 02 uses standard responsive sizes for mobile */
          .intro-square { width: min(88vw, 380px); }
        }

        @media (max-width: 768px) {
            .final-text-overlay {
            grid-template-columns: 1fr;  /* single column on tablet/phone */
            gap: 20px;
            width: clamp(280px, 90vw, 640px);
            max-width: 640px;
          }
          .final-text-overlay p { font-size: 15px; line-height: 1.3; }
          .final-navigation-links {
            width: clamp(280px, 90vw, 640px);
            gap: 16px;
            font-size: 15px;
          }
        }

        @media (max-width: 480px) {
          .final-text-overlay p { font-size: 14px; line-height: 1.35; }
          .final-navigation-links { font-size: 14px; }
        }

        /* Footer buttons: match intro button text size exactly */
        .final-navigation-links .intro-button{ font-size: 12px; }
        
        /* Mobile accessibility improvements */
        @media (max-width: 768px) {
          /* Ensure proper focus indicators on mobile */
          .intro-button:focus,
          .module-popup-btn:focus,
          .final-navigation-links .intro-button:focus {
            outline: 2px solid #333;
            outline-offset: 2px;
          }
          /* Improve touch targets for navigation */
          .final-navigation-links .intro-button {
            min-height: 44px;
            padding: 8px 12px;
          }
        }


        @media (max-width: 768px) {
          .nav-play-button { width: 32px; height: 32px; }
          .nav-play-button .icon { width: 16px; height: 16px; }
        }

        /* === Scroll cubes (central column) === */
        .cube-block {
          width: 100%;
          display: flex;
          justify-content: center;
          align-items: center;
          margin: 40px 0;
          position: relative;
          z-index: 10;                    /* top layer in textPanel */
        }

        .cube-scene {
          width: 280px;
          height: 280px;
          perspective: 1200px;
          display: flex;
          justify-content: center;
          align-items: center;
          cursor: grab;
          touch-action: none; /* allow pointer-driven rotation without scrolling */
        }

        .cube-scene.dragging { cursor: grabbing; }

        .cube {
          position: relative;
          width: 200px;
          height: 200px;
          transform-style: preserve-3d;
          will-change: transform;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

        .cube-face {
          position: absolute;
          width: 200px;
          height: 200px;
          background: rgba(255,255,255,0.83);  /* ~15% more transparent than before */
          border: 2px solid #333;         /* match site stroke weight */
          backface-visibility: visible;   /* show back faces to see through */
          transform: translateZ(0);       /* force GPU acceleration */
          -webkit-transform: translateZ(0);
          display: flex;                  /* center any face content */
          align-items: center;
          justify-content: center;
          text-align: center;
        }

        .cube-text {
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          font-weight: 400;
          font-size: 11.2px;             /* 20% smaller than 14px */
          line-height: 1.2;
          color: #000;
          padding: 0 12px;               /* avoid touching borders */
          user-select: none;              /* prevent accidental selection while dragging */
          pointer-events: none;           /* don't block drag interactions */
        }

        .cube-logo {
          max-width: 60px;               /* reasonable size for logo */
          max-height: 60px;
          width: auto;
          height: auto;
          padding: 12px;                 /* consistent with cube-text padding */
          user-select: none;              /* prevent accidental selection while dragging */
          pointer-events: none;           /* don't block drag interactions */
          object-fit: contain;            /* maintain aspect ratio */
        }

        .cube-clock {
          font-family: 'MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          font-weight: 400;
          font-size: 11.2px;
          line-height: 1;
          color: #000;
          padding: 0 8px;
          user-select: none;
          pointer-events: none;
        }

        /* Build a proper cube: 200×200×200 - all sides equal */
        .cube-face--front  { transform: translateZ(100px); }
        .cube-face--back   { transform: rotateY(180deg) translateZ(100px); }
        .cube-face--right  { transform: rotateY(90deg) translateZ(100px); }
        .cube-face--left   { transform: rotateY(-90deg) translateZ(100px); }
        .cube-face--top    { transform: rotateX(90deg) translateZ(100px); }
        .cube-face--bottom { transform: rotateX(-90deg) translateZ(100px); }

        @media (prefers-reduced-motion: reduce) {
          .cube { transition: none !important; }
        }

        /* ===== Earthy palette for modules ===== */
        :root{
          --mod-surface:  #e6e7e8;
          --mod-systems:  #a7a9ac;
          --mod-signals:  #f15a29;
          --mod-substance:#2e3192;
          --mod-core:     #414042;
        }
        /* ===== Sections inside the existing text panel ===== */
        /* Make modules cover the panel with the same translucent feel */
        .text-panel { padding: 0; }
        .text-panel { background: transparent !important; }
        .text-panel .section{ position: relative; width: 100%; height: 80vh; display: flex; align-items: center; border: none; }
        .text-panel .section + .section{ border-top: 2px solid #333; }
        .text-panel .section-01{ background: #e6e7e8; position: relative; }
        .section-bg-video {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          object-fit: cover;
          z-index: 10;
        }
        .module-title {
            position: absolute;
            top: calc(20% - 55px);
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Sabbath Black', serif;
            font-size: clamp(28px, 4vw, 48px);
            color: #000000;
            text-align: center;
            z-index: 15;
            margin: 0;
            font-weight: 400;
            letter-spacing: 0.02em;
            white-space: nowrap;
            opacity: 0;
            animation: fadeInText 1.5s ease-in-out 0.5s forwards;
        }
    .module-subtitle {
        position: absolute;
        top: calc(20% - 70px + 70px);
        left: 50%;
        transform: translateX(-50%);
        font-family: 'Minion3 Regular', serif !important;
        font-size: clamp(16px, 2.5vw, 24px);
        color: #ffffff !important;
        text-align: center;
        z-index: 15;
        margin: 0;
        font-weight: 400;
        letter-spacing: 0.01em;
        white-space: nowrap;
        opacity: 0;
        animation: fadeInText 1.5s ease-in-out 1.5s forwards;
    }
    
    .author-name {
        font-family: 'KH Teka', 'KHTeka-Regular', serif !important;
        font-weight: 400 !important;
    }

    /* Hide line break on desktop */
    .mobile-break {
        display: none;
    }

    /* Mobile-specific: Two-line subheading */
    @media (max-width: 768px) {
        .module-subtitle {
            white-space: normal;
            line-height: 1.2;
            text-align: center;
            width: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 0 20px;
            box-sizing: border-box;
        }
        
        .mobile-break {
            display: inline;
        }
    }
        @keyframes fadeInText {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .text-panel .section-02{ background: rgba(230,231,232,0.95); }
        .text-panel .section-03{ background: rgba(167,169,172,0.95); }
        .text-panel .section-04{ background: rgba(241,90,41,0.95); }
        .text-panel .section-05{ background: rgba(46,49,146,0.95); }
        .text-panel .section-06{ background: rgba(65,64,66,0.95); }
        .text-panel .section-07{ background: rgba(0,0,0,0.95); }
        .text-panel .section-inner{ width: 100%; margin: 0; padding: 32px 5%; height: 100%; display: flex; flex-direction: column; justify-content: center; text-align: left; transform: translateY(-10%); }
        .text-panel .section-01 .section-inner{ padding: 32px 5%; display: grid; place-items: center; transform: none; background: transparent; }
        .text-panel .section-01 .intro-grid{ background: transparent; }
        /* ===== Type system ===== */
        .module-number{ font-family: 'Minion Pro', serif; font-size: 16px; letter-spacing: 0.02em; margin: 0 0 16px 0; color: #000; font-weight: 400; font-synthesis: none; -webkit-font-smoothing: antialiased; text-align: left; position: relative; z-index: 1; }
        /* Module 02 number should match Module 01 subtext size and use Monument Grotesk Semi Mono */
        .section-02 .module-number{ font-size: clamp(6px, 2.2vw, 18px); font-family: 'Monument Semi Grotesk','MonumentGrotesk-Semi-Mono', system-ui, -apple-system, Arial, sans-serif; }
        /* Modules 03-07 numbers should use Monument Grotesk Semi Mono */
        .section-03 .module-number,
        .section-04 .module-number,
        .section-05 .module-number,
        .section-06 .module-number,
        .section-07 .module-number{ font-family: 'Monument Semi Grotesk','MonumentGrotesk-Semi-Mono', system-ui, -apple-system, Arial, sans-serif; }
        .section-05 .module-number, .section-06 .module-number, .section-07 .module-number{ color: #F5F6F7; }
        .section-title{ font-family: 'Monument Semi Grotesk','MonumentGrotesk-Semi-Mono', system-ui, -apple-system, Arial, sans-serif; font-size: clamp(21px, 4.25vw, 41px); letter-spacing: 0.01em; margin: 0 0 12px 0; color: #000; font-weight: 400; font-synthesis: none; -webkit-font-smoothing: antialiased; text-align: left; hyphens: none; -webkit-hyphens: none; -ms-hyphens: none; }
        .section-title .dist, .section-title .status { display:block; font-size: 16px; line-height: 1.2; letter-spacing: 0; margin-top: 2px; }
        .section-body{ font-family: 'KH Teka', system-ui, -apple-system, Arial, sans-serif; font-size: clamp(6px, 2.2vw, 18px); line-height: 1.32; max-width: 62ch; color: #000; text-align: left; hyphens: none; -webkit-hyphens: none; -ms-hyphens: none; overflow-wrap: normal; word-break: normal; }
        @media (max-width: 768px){
          /* Ensure all modules body text matches global body size on mobile */
          .section-body{ font-size: 16px; }
        }
        /* Smooth filter transitions for text */
        .section-title, .section-body{
          transition: filter 820ms cubic-bezier(0.2, 0.6, 0.15, 1);
          will-change: filter;
        }
        .section-05 .section-title, .section-05 .section-body, .section-06 .section-title, .section-06 .section-body, .section-07 .section-title, .section-07 .section-body{ color: #F5F6F7; }
        /* ===== Intro (module 1) ===== */
        .intro-grid{ display: grid; grid-template-rows: auto auto; justify-items: center; row-gap: 28px; height: 100%; align-content: center; }
        .section-01 .intro-links{ margin-top: 8px; }
        .intro-grid{ position: relative; z-index: 15; }
        .intro-square{ width: min(64vw, 520px); aspect-ratio: 1 / 1; border: none; display: grid; place-items: center; background: transparent; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2; opacity: 1; transition: opacity 320ms ease; }
        .intro-square .cube-block{ margin: 0; }
        .intro-copy{ position: absolute; inset: 0; display: flex; flex-direction: column; align-items: flex-start; justify-content: center; padding: 32px 5%; text-align: left; text-align-last: left; z-index: 1; pointer-events: auto; width: 100%; background: transparent; }
        .intro-copy .intro-text{
          font-family: 'MonumentGrotesk-Semi-Mono', 'Monument Semi Grotesk', Arial, sans-serif;
          color: #000000;
          letter-spacing: 0.01em;
          /* 50% smaller from the previous size */
          font-size: clamp(21px, 4.25vw, 41px);
          text-align: center;
          text-align-last: center;
          line-height: 1.08;
          margin: 0;
          width: auto;
          max-width: 90%;
          align-self: center;
          hyphens: none !important;
          -webkit-hyphens: none !important;
          -ms-hyphens: none !important;
          overflow-wrap: normal !important;
          word-break: normal !important;
          position: relative;
          z-index: 0; /* text sits behind cube */
        }
        /* Subtext reveal under title */
        .intro-subtext{ 
          font-family: 'KH Teka', system-ui, -apple-system, Arial, sans-serif !important; 
          color: #000000; /* black */
          letter-spacing: 0.01em; 
          font-size: clamp(6px, 2.2vw, 18px) !important; 
          line-height: 1.1; 
          margin: 8px 0 0 0; 
          max-width: 90%; 
          opacity: 0; 
          transform: translateY(8px); 
          pointer-events: none; 
          text-align: left; 
          text-align-last: left; 
          position: absolute; 
          top: calc(50% + 28px); /* appear below centered title without affecting layout */
        }
        /* Ensure Module 01 subtext and its words are black with highest priority */
        .section-01 .intro-subtext, 
        .section-01 .intro-subtext .word{ color: #000000 !important; }
        .intro-subtext .word{ opacity: 0; display: inline-block; transform: translateY(8px); }
        .intro-subtext.revealed{ opacity: 1; transform: translateY(0); transition: opacity 360ms cubic-bezier(0.2, 0.6, 0.15, 1), transform 360ms cubic-bezier(0.2, 0.6, 0.15, 1); }

        /* Title shift animation when cube is hidden */
        .title-shift{ transition: transform 420ms cubic-bezier(0.2, 0.6, 0.15, 1); will-change: transform; transform: translateY(0); }
        .title-shift.up{ transform: translateY(-56px); }
        /* Scroll indicator */
        .scroll-indicator {
          position: absolute;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          font-size: 16px;
          color: #000000;
          opacity: 0.6;
          animation: gentleFade 3s ease-in-out infinite;
          z-index: 10;
          pointer-events: none;
        }
        
        @keyframes gentleFade {
          0%, 100% { opacity: 0.3; }
          50% { opacity: 0.8; }
        }
        
        /* Intro actions (buttons at base of module) */
        .section-01{ position: relative; }
        .intro-actions-bottom{ 
          position: absolute; 
          bottom: 2px; 
          left: 0; 
          right: 0; 
          display: flex; 
          gap: 12px; 
          justify-content: center; 
          padding: 0 5%; 
          pointer-events: auto; 
          z-index: 20; 
          transform: translateY(0);
          transition: none;
        }
        .intro-button{ 
          appearance: none; 
          -webkit-appearance: none; 
          border: none; 
          background: transparent; 
          color: #ffffff; 
          padding: 8px 0; 
          font-family: 'KH Teka', system-ui, -apple-system, Arial, sans-serif; 
          font-size: 12px; 
          line-height: 1; 
          letter-spacing: 0.02em; 
          text-decoration: none; 
          display: inline-flex; 
          align-items: center; 
          justify-content: center; 
          cursor: pointer; 
          pointer-events: auto; 
          position: relative; 
          z-index: 20; 
          outline: none;
          /* underline animation handled via ::after */
        }
        /* All module buttons should use consistent 12px font size */
        .intro-button{ font-size: 12px; }
        
        /* Reactive text color inversion only when video is active behind button */
        .intro-button.active,
        .intro-button:active {
            color: #000;
            mix-blend-mode: difference;
            transition: all 0.3s ease;
        }
        /* Ensure module popup buttons don't stretch full width in column flex containers */
        .module-popup-btn{ align-self: flex-start; }
        html { scroll-behavior: smooth; }
        .intro-button:focus{ outline: none; }
        /* Elegant underline animation */
        .intro-button::after{
          content: "";
          position: absolute;
          left: 0;
          bottom: 7px;             /* align near text baseline (padding-bottom is 8px) */
          width: 100%;             /* match button text width */
          height: 1px;             /* thin, elegant line */
          background: currentColor;
          transform: scaleX(0);
          transform-origin: left center;
          opacity: 0;
          transition: transform 240ms cubic-bezier(0.2, 0.6, 0.15, 1), opacity 160ms ease;
          will-change: transform, opacity;
        }
        .intro-button:hover::after,
        .intro-button:focus-visible::after{
          transform: scaleX(1);
          opacity: 1;
        }
        /* Click micro-animation */
        .intro-button:active::after{
          animation: underlineClick 180ms ease-out;
        }
        /* Ensure module popup button uses the same underline animation */
        .module-popup-btn:hover::after,
        .module-popup-btn:focus-visible::after{ transform: scaleX(1); opacity: 1; }
        .module-popup-btn:active::after{ animation: underlineClick 180ms ease-out; }
        @keyframes underlineClick{
          0%   { transform: scaleX(1); height: 1px; }
          50%  { transform: scaleX(0.9); height: 2px; }
          100% { transform: scaleX(1); height: 1px; }
        }
        @media (prefers-reduced-motion: reduce){
          .intro-button::after{ transition: none; transform: scaleX(1); }
        }

        /* Mobile refinements */
        @media (max-width: 480px){
          /* Keep subtext readable and properly placed on small screens */
          .intro-subtext{ font-size: clamp(12px, 3.8vw, 18px) !important; top: calc(52% + 20px); }
          /* Improve tap targets and avoid home-indicator overlap */
          .intro-actions-bottom{ padding-bottom: calc(8px + env(safe-area-inset-bottom)); }
          .intro-button{ padding: 10px 0; min-height: 44px; /* iOS recommended tap target */ }
          /* Ensure cube container remains perfectly centered on small screens */
          .section-01 .intro-grid{ place-items: center; }
          .intro-square{ 
            left: 50%; 
            top: 50%; 
            /* slight upward optical correction on small screens so it feels perfectly centered */
            transform: translate(-50%, calc(-50% - 8px)); 
            margin: 0; 
          }
          /* Optimize scrolling performance on mobile */
          .text-panel { 
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
          }
          /* Prevent zoom on input focus */
          input, textarea, select { font-size: 16px; }
          /* Optimize animations for mobile */
          .intro-square { 
            -webkit-transform: translate(-50%, calc(-50% - 8px)); 
            transform: translate(-50%, calc(-50% - 8px)); 
          }
          /* Ensure proper touch targets for all interactive elements */
          .module-popup-btn { min-height: 44px; padding: 8px 0; }
          /* Optimize text rendering on mobile */
          .section-title, .section-body, .module-number { 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
          }
        }
        .intro-button:active{ outline: none; }
        .intro-button[disabled]{ opacity: 0.6; cursor: default; }
        .intro-square.hidden{ opacity: 0; pointer-events: none; }
        /* Use title formatting for all intro text, scaled 200% to fill the module */
        .intro-copy .section-title,
        .intro-copy .section-body{
          font-family: 'Monument Semi Grotesk','MonumentGrotesk-Semi-Mono', Arial, sans-serif;
          color: #000;
          letter-spacing: 0.01em;
          font-size: 48px; /* unified size */
          line-height: 1.1;
          text-align: left;
          hyphens: none;
          -webkit-hyphens: none;
          -ms-hyphens: none;
        }
        .intro-copy .section-title{ margin: 0 0 12px 0; width: 100%; }
        .intro-copy .section-body{ max-width: 100%; width: 100%; }
        /* ensure last line justifies to edges */
        .intro-copy .section-title::after,
        .intro-copy .section-body::after{ content: ""; display: inline-block; width: 100%; }
        #cubeMount, #cubeMount > *{ width: 100%; height: 100%; }
        .intro-links{ display: none; z-index: 20; }
        .intro-link{ font-family: "Monument Semi Grotesk", system-ui, -apple-system, Arial, sans-serif; font-size: 18px; text-decoration: none; color: #000; }
        .section-06 .intro-link { color: #F5F6F7; }

        /* Module popup: small, centered square image per module */
        .module-popup{
          position: absolute; inset: 0; display: block; pointer-events: none; opacity: 0;
          transition: opacity 820ms cubic-bezier(0.2, 0.6, 0.15, 1);
          will-change: opacity;
          z-index: 1000;
          margin: 0; padding: 0; border: none; outline: none;
        }
        .module-popup.show{ opacity: 1; pointer-events: none; }
        .module-popup.show .module-popup-btn{ pointer-events: auto; }
        .module-popup .popup-backdrop{ display: none; }
        .module-popup .popup-card{
          position: absolute; top: 0; left: 0; right: 0; bottom: 0;
          transform: scale(0.985);
          transition: transform 900ms cubic-bezier(0.2, 0.6, 0.15, 1);
          will-change: transform;
          width: 100%; height: 100%; background: transparent; border: none; display: block; overflow: hidden; box-shadow: none; margin: 0 !important; padding: 0 !important;
          box-sizing: border-box !important;
          z-index: 1;
        }
        .module-popup.show .popup-card{ transform: scale(1); }
        .module-popup .popup-card img,
        .module-popup .popup-card video{ 
          position: absolute; 
          top: 0; 
          left: 0; 
          right: 0;
          bottom: 0;
          width: 100%; 
          height: 100%; 
          object-fit: cover; 
          display: block; 
          margin: 0 !important; 
          padding: 0 !important;
          border: none !important;
          outline: none !important;
          box-sizing: border-box !important;
          max-width: none !important;
          max-height: none !important;
        }

        /* Anchor the module button to the module (not the text flow) */
        .text-panel .section .module-popup-btn{ position: absolute; left: 5%; bottom: 16px; z-index: 99999; }
        /* White text for buttons in white-text modules */
        .text-panel .section-05 .module-popup-btn,
        .text-panel .section-06 .module-popup-btn,
        .text-panel .section-07 .module-popup-btn{ color: #F5F6F7; }
        /* Fade the text when module popup is open; buttons remain visible */
        .text-panel .section.blur-text .section-title,
        .text-panel .section.blur-text .section-body{ 
          opacity: 0; 
          transition: opacity 820ms cubic-bezier(0.2, 0.6, 0.15, 1);
        }
        /* Ensure module popup button stays visible and doesn't fade */
        .text-panel .section.blur-text .module-popup-btn,
        .text-panel .section.blur-text .intro-button,
        .text-panel .section.blur-text .module-popup-btn.sr,
        .text-panel .section.blur-text .intro-button.sr{
          opacity: 1 !important;
          transition: none !important;
          transform: none !important;
        }
        /* Invert module popup button color when active (pressed) */
        .text-panel .section.blur-text .module-popup-btn{ color: #F5F6F7 !important; }
        /* Keep button anchored to module when popup is open */
        .text-panel .section.blur-text button.module-popup-btn.intro-button{
          opacity: 1 !important;
          transition: none !important;
          transform: none !important;
          visibility: visible !important;
          display: block !important;
          position: absolute !important; /* anchor to module */
          left: 5% !important;
          bottom: 16px !important;
          z-index: 9999 !important;
        }
        /* Nuclear option: override any possible fade with maximum specificity */
        .text-panel .section.blur-text .section-inner .module-popup-btn,
        .text-panel .section.blur-text .section-inner .intro-button,
        .text-panel .section.blur-text .module-popup-btn,
        .text-panel .section.blur-text .intro-button{
          opacity: 1 !important;
          visibility: visible !important;
          display: block !important;
          pointer-events: auto !important;
          transition: none !important;
          transform: none !important;
          filter: none !important;
        }

        /* Scroll-reveal base */
        .text-panel .sr { opacity: 0; transform: translateY(12px); transition: opacity .5s ease, transform .6s ease; will-change: opacity, transform; transition-delay: var(--sr-delay, 0s); }
        .text-panel .sr.revealed { opacity: 1; transform: translateY(0); }
        /* Paragraphs as single blocks (no per-sentence/word lines) */
        .text-panel .section-body .sr { display: inline; }


    </style>
</head>
<body>
    <!-- Left Margin -->
    <div class="left-margin"></div>

    <!-- Right Margin -->
    <div class="right-margin"></div>


    <!-- Fixed Navigation Bar -->
    <nav class="nav-bar">
        <p class="nav-text"></p>
        <div class="nav-player" role="group" aria-label="Playback">
          <span class="label">Now playing:</span>
          <span id="navTrackTitle" class="track">Track title</span>
          <button id="navMuteBtn" class="nav-mute" type="button" aria-pressed="false">Mute</button>
        </div>
        <p class="nav-depth-counter" id="navDepthCounter">0m</p>
    </nav>
    


    <!-- Unified hero -->
    <main id="hero" class="hero">
      <div id="bg" class="bg">
        <div class="background-block"><img src="assets/images/background/001.png" alt="Background 001" decoding="async" fetchpriority="high"></div>
        <div class="background-separator"></div>
        <div class="background-block"><img src="assets/images/background/002.png" alt="Background 002" decoding="async" loading="lazy"></div>
        <div class="background-separator"></div>
        <div class="background-block"><img src="assets/images/background/002.5.png" alt="Background 002.5" decoding="async" loading="lazy"></div>
        <div class="background-separator"></div>
        <div class="background-block"><img src="assets/images/background/003.png" alt="Background 003" decoding="async" loading="lazy"></div>
        <div class="background-separator"></div>
        <div class="background-block"><img src="assets/images/background/004.png" alt="Background 004" decoding="async" loading="lazy"></div>
        <div class="background-separator"></div>
        <div class="background-block"><img src="assets/images/background/005.png" alt="Background 005" decoding="async" loading="lazy"></div>
        <div class="background-separator"></div>
        <div class="background-block"><img src="assets/images/background/006-3.png" alt="Background 006-3" decoding="async" loading="lazy"></div>
      </div>

      <section id="textPanel" class="text-panel" tabindex="0" aria-label="Story">
        <!-- ===== Six-module scaffold (inside #textPanel) ===== -->
        <section class="section section-01" aria-label="Intro">
          <video class="section-bg-video" autoplay muted playsinline>
            <source src="assets/images/textPanel/door-firstpass0001-0250.mp4" type="video/mp4">
            <p>Your browser doesn't support HTML5 video.</p>
          </video>
          <h1 class="module-title">The only way out is in</h1>
          <p class="module-subtitle">Text and Images by <span class="mobile-break"><br></span><span class="author-name">OSCAR B. MORGAN</span></p>
          <div class="section-inner intro-grid">
            <nav class="intro-links" aria-label="Primary links">
              <a class="intro-link" href="mailto:studio@oscarbmorgan.com">Contact</a>
              <a class="intro-link" href="#about">About</a>
            </nav>
          </div>
          <div class="intro-actions-bottom" role="group" aria-label="Intro actions">
            <a class="intro-button" href="mailto:studio@oscarbmorgan.com">Contact</a>
            <a class="intro-button" href="#footerPanel">About</a>
            <a class="intro-button" href="#field-notes">Field notes</a>
            <a class="intro-button" href="#">Shop</a>
          </div>
        </section>
        <section class="section section-02" aria-label="Surface">
          <div class="section-inner">
            <div class="module-number">001</div>
            <h2 class="section-title sr"><span class="ttl">Surface</span></h2>
            <p class="section-body sr">Work visible in the world. <span style="font-family: 'Minion Pro', serif; font-style: italic;">Creative strategy based on cultural observation, interrogation, and participation. Brand stewardship, concept development, text and image consultation.</span></p>
            <div class="module-popup" data-module="section-02" aria-hidden="true">
              <div class="popup-backdrop" aria-hidden="true"></div>
              <div class="popup-card" role="dialog" aria-label="Preview">
                <video src="assets/images/textPanel/peacock-video.mp4" autoplay loop muted playsinline>
                  <p>Your browser doesn't support HTML5 video.</p>
                </video>
                <video src="assets/images/textPanel/peack-video-2.mp4" autoplay loop muted playsinline>
                  <p>Your browser doesn't support HTML5 video.</p>
                </video>
              </div>
            </div>
          </div>
          <button class="intro-button module-popup-btn" data-module="section-02" type="button" aria-haspopup="dialog">[Click to view]</button>
        </section>
        <section class="section section-03" aria-label="Formation">
          <div class="section-inner">
            <div class="module-number">002</div>
            <h2 class="section-title sr"><span class="ttl">Formation</span></h2>
            <p class="section-body sr">Systems for efficiency and repeatability. <span style="font-family: 'Minion Pro', serif; font-style: italic;">The assessment and integration of new tools and emerging technologies. The building of scalable frameworks for creative output that utilise automation with intention.</span></p>
            <div class="module-popup" data-module="section-03" aria-hidden="true">
              <div class="popup-backdrop" aria-hidden="true"></div>
              <div class="popup-card" role="dialog" aria-label="Preview">
                <video src="assets/images/textPanel/system-animation.mp4" autoplay loop muted playsinline>
                  <p>Your browser doesn't support HTML5 video.</p>
                </video>
              </div>
            </div>
          </div>
          <button class="intro-button module-popup-btn" data-module="section-03" type="button" aria-haspopup="dialog">[Click to view]</button>
        </section>
        <section class="section section-04" aria-label="Seam">
          <div class="section-inner">
            <div class="module-number">003</div>
            <h2 class="section-title sr"><span class="ttl">Seam</span></h2>
            <p class="section-body sr">Intuition – or, what's happening and where it's happening. <span style="font-family: 'Minion Pro', serif; font-style: italic;">Trend mapping and the collection and ongoing interaction with media.</span></p>
            <div class="module-popup" data-module="section-04" aria-hidden="true">
              <div class="popup-backdrop" aria-hidden="true"></div>
              <div class="popup-card" role="dialog" aria-label="Preview">
                <video src="assets/images/textPanel/eyball_update_2.mp4" autoplay loop muted playsinline preload="auto" style="width: 100%; height: 100%; object-fit: cover;">
                  <p>Your browser doesn't support HTML5 video.</p>
                </video>
              </div>
            </div>
          </div>
          <button class="intro-button module-popup-btn" data-module="section-04" type="button" aria-haspopup="dialog">[Click to view]</button>
        </section>
        <section class="section section-05" aria-label="Bedrock">
          <div class="section-inner">
            <div class="module-number">004</div>
            <h2 class="section-title sr"><span class="ttl">Bedrock</span></h2>
            <p class="section-body sr">Interrogating existing systems of power. <span style="font-family: 'Minion Pro', serif; font-style: italic;">Thinking about why we do things, how, and who they affect. Ongoing analysis of ethical approaches to shifting technology used in the production and distribution of creative work. Leadership with empathy that creates space for experimentation.</span></p>
            <div class="module-popup" data-module="section-05" aria-hidden="true">
              <div class="popup-backdrop" aria-hidden="true"></div>
              <div class="popup-card" role="dialog" aria-label="Preview">
                <video src="assets/images/textPanel/slide0001-0250.mp4" autoplay loop muted playsinline preload="auto" style="width: 100%; height: 100%; object-fit: cover;">
                  <p>Your browser doesn't support HTML5 video.</p>
                </video>
              </div>
            </div>
          </div>
          <button class="intro-button module-popup-btn" data-module="section-05" type="button" aria-haspopup="dialog">[Click to view]</button>
        </section>
        <section class="section section-06" aria-label="Core">
          <div class="section-inner">
            <div class="module-number">006</div>
            <h2 class="section-title sr"><span class="ttl">Core</span></h2>
            <p class="section-body sr">Simply, the ongoing pursuit of the successful integration of attitudes towards art, culture, and commerce into creative as a service.</p>
            <div class="module-popup" data-module="section-06" aria-hidden="true">
              <div class="popup-backdrop" aria-hidden="true"></div>
              <div class="popup-card" role="dialog" aria-label="Preview">
                <video src="assets/images/textPanel/door-test.mp4" autoplay loop muted playsinline preload="auto" style="width: 100%; height: 100%; object-fit: cover;">
                  <p>Your browser doesn't support HTML5 video.</p>
                </video>
              </div>
            </div>
          </div>
          <button class="intro-button module-popup-btn" data-module="section-06" type="button" aria-haspopup="dialog">[Click to view]</button>
        </section>
        <section class="section section-07" aria-label="Foundation">
          <div class="section-inner">
          </div>
        </section>

      </section>
    </main>

    <footer id="footerPanel" class="footer-panel" aria-label="Footer">
      <div class="final-text-overlay">
                <div class="final-text-column">
                    <p>The convergence of art and technology creates new possibilities for human expression. Each pixel, each line of code, each design decision becomes part of a larger conversation about how we communicate, connect, and create meaning in the digital age.</p>
                </div>
                <div class="final-text-column">
                    <p>The future belongs to those who can navigate complexity while maintaining clarity of vision. As tools evolve and possibilities multiply, the fundamental challenge remains: how do we create work that serves human needs and elevates the human experience?</p>
                </div>
            </div>
      <div class="final-navigation-links" style="pointer-events:auto; display:flex; justify-content:center; gap:12px; padding: 16px 0;">
        <a class="intro-button" href="#instagram">Instagram</a>
        <a class="intro-button" href="#youtube">Youtube</a>
        <a class="intro-button" href="#soundcloud">Soundcloud</a>
        <a id="backToTopBtn" class="intro-button" href="#textPanel">Back to top</a>
      </div>
      <div id="page-end"></div>
    </footer>

    <script>
  const bg = document.getElementById('bg');
  const textPanel = document.getElementById('textPanel');
  const footer = document.getElementById('footerPanel');
        const navDepthCounter = document.getElementById('navDepthCounter');
  const heroEl = document.getElementById('hero');
  // Footer reveal damping state
  let footerRevealTimer = null;
  let footerHideTimer = null;
  let footerIsShown = false;

  const REDUCED = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  function clamp(v, min, max) { return Math.min(max, Math.max(min, v)); }

  // === Scroll-driven cube controller ===
  const cubeBlocks = Array.from(document.querySelectorAll('.cube-block'));
  const REDUCED_MOTION = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Cube rotation state
  const cubeStates = cubeBlocks.map((block, i) => ({
    block,
    scene: block.querySelector('.cube-scene'),
    cube: block.querySelector('.cube'),
    rotX: 0,
    rotY: 0,
    rotZ: 0,
    baseSpeedX: (0.3 + i * 0.15) * 0.075,  // 92.5% slower (7.5% of original)
    baseSpeedY: (0.4 + i * 0.12) * 0.075,
    baseSpeedZ: (0.2 + i * 0.08) * 0.075,
    scrollMultiplier: 0,
    hoverBoost: 0,
    isDragging: false,
    lastPointerX: 0,
    lastPointerY: 0,
    dragSensitivity: 0.5  // degrees per pixel
  }));

  // Hover pulse: brief 10% speed boost that decays
  for (const state of cubeStates) {
    const hoverEl = state.block; // trigger on the whole cube block area
    if (!hoverEl) continue;
    hoverEl.addEventListener('mouseenter', () => { state.hoverBoost = 0.10; });
    hoverEl.addEventListener('mouseleave', () => { state.hoverBoost = 0; });
  }

  // Pointer drag controls for cube rotation
  for (const state of cubeStates) {
    const sceneEl = state.scene;
    if (!sceneEl) continue;
    sceneEl.addEventListener('pointerdown', (e) => {
      state.isDragging = true;
      state.lastPointerX = e.clientX;
      state.lastPointerY = e.clientY;
      sceneEl.classList.add('dragging');
      try { sceneEl.setPointerCapture(e.pointerId); } catch (_) {}
    });
    sceneEl.addEventListener('pointermove', (e) => {
      if (!state.isDragging) return;
      const dx = e.clientX - state.lastPointerX;
      const dy = e.clientY - state.lastPointerY;
      // Horizontal drag rotates around Y, vertical drag rotates around X
      state.rotY += dx * state.dragSensitivity;
      state.rotX -= dy * state.dragSensitivity;
      state.lastPointerX = e.clientX;
      state.lastPointerY = e.clientY;
    });
    function endDrag(e) {
      if (!state.isDragging) return;
      state.isDragging = false;
      sceneEl.classList.remove('dragging');
      try { sceneEl.releasePointerCapture(e.pointerId); } catch (_) {}
    }
    sceneEl.addEventListener('pointerup', endDrag);
    sceneEl.addEventListener('pointercancel', endDrag);
    sceneEl.addEventListener('pointerleave', endDrag);
  }

  // progress of an element inside a scroll container: 0 at enter, 1 when fully passed
  function elementProgress(el, scroller) {
    const r = el.getBoundingClientRect();
    const s = scroller.getBoundingClientRect();
    const vh = s.height;
    const p = 1 - clamp((r.top - s.top) / vh, 0, 1);
    return p;
  }

  // Animate cubes continuously - Performance optimized
  let lastCubeTime = performance.now();
  let cubesRAF = null, cubesActive = false;
  let isScrolling = false;
  let scrollTimeout = null;
  
  function tickCubes(time) {
    if (!REDUCED_MOTION && cubeStates.length > 0) {
      const dt = (time - lastCubeTime) / 1000; // delta in seconds
      lastCubeTime = time;

      for (const state of cubeStates) {
        if (!state.cube) continue;
        
        // Performance optimization: Only animate visible cubes
        const rect = state.block.getBoundingClientRect();
        const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
        if (!isVisible) continue;

        // Calculate scroll-based speed multiplier
        const progress = elementProgress(state.block, textPanel);
        state.scrollMultiplier = 1 + progress * 4; // 1x to 5x speed based on scroll

        // Update rotation angles (include transient hover boost, pause while dragging)
        // Performance optimization: Reduce animation during scroll
        const scrollThrottle = isScrolling ? 0.3 : 1.0;
        const speedMult = (state.isDragging ? 0 : state.scrollMultiplier * (1 + state.hoverBoost) * scrollThrottle);
        state.rotX += state.baseSpeedX * speedMult * dt * 60; // normalize to 60fps
        state.rotY += state.baseSpeedY * speedMult * dt * 60;
        state.rotZ += state.baseSpeedZ * speedMult * dt * 60;

        // Apply transform with off-axis rotation
        state.cube.style.transform = 
          `rotateX(${state.rotX}deg) rotateY(${state.rotY}deg) rotateZ(${state.rotZ}deg)`;

        // Decay hover pulse quickly (~0.4s)
        if (state.hoverBoost > 0) {
          state.hoverBoost = Math.max(0, state.hoverBoost - dt * 2.5);
        }
      }
    }
    cubesRAF = requestAnimationFrame(tickCubes);
  }
  function startCubes(){ 
    if (!cubesActive){ 
      cubesActive = true; 
      cubesRAF = requestAnimationFrame(tickCubes); 
    } 
  }
  
  // Performance optimization: Throttle animation during scroll
  function onScrollStart() {
    isScrolling = true;
    clearTimeout(scrollTimeout);
  }
  
  function onScrollEnd() {
    scrollTimeout = setTimeout(() => {
      isScrolling = false;
    }, 150); // Stop throttling 150ms after scroll ends
  }
  
  // Keep the cube moving gently at all times (no stop)
  function stopCubes(){ /* intentionally no-op to preserve gentle continuous motion */ }

  const tp = document.getElementById('textPanel');
  let scrollStopTimer;
  tp.addEventListener('scroll', () => {
    onScrollStart();
    startCubes();
  }, { passive: true });
  
  // Add scroll end detection
  tp.addEventListener('scroll', () => {
    clearTimeout(scrollStopTimer);
    scrollStopTimer = setTimeout(onScrollEnd, 100);
  }, { passive: true });
  
  // start immediately
  startCubes();

  // Performance optimization: Cache expensive calculations
  let cachedHeroH = null;
  let cachedBgMax = null;
  let lastScrollTop = -1;
  
  function update() {
    const textMax = Math.max(1, textPanel.scrollHeight - textPanel.clientHeight);
    const t = clamp(textPanel.scrollTop / textMax, 0, 1);
    
    // Performance optimization: Skip update if scroll position hasn't changed significantly
    const currentScrollTop = textPanel.scrollTop;
    if (Math.abs(currentScrollTop - lastScrollTop) < 1) return;
    lastScrollTop = currentScrollTop;

    // Map text progress to background timeline with offset
    const offsetStart = 0.00; // reveal full top of first image
    const offsetEnd   = 1.00;

    // Performance optimization: Cache hero height and bg max calculations
    if (cachedHeroH === null) {
      cachedHeroH = heroEl.clientHeight;
      cachedBgMax = Math.max(1, bg.scrollHeight - cachedHeroH);
    }
    
    const bgProg = clamp(offsetStart + (offsetEnd - offsetStart) * t, 0, 1);
    const y      = -bgProg * cachedBgMax;

    // Reduced motion: freeze background, but still update UI state
    bg.style.transform = REDUCED ? 'translateY(0)' : `translateY(${y}px)`;

    // Depth counter should start at 0m (use text progress, not bgProg)
    if (navDepthCounter) {
      // Ease the counter value for a smoother feel, but snap at boundaries
      const targetDepth = Math.max(0, Math.round(t * 10000));
      if (t < 0.001) {
        // snap to 0 at the very top to avoid lingering values
        update._depth = 0;
      } else if (typeof update._depth === 'undefined') {
        update._depth = targetDepth;
      } else {
        const delta = targetDepth - update._depth;
        // snap when within 1m to avoid jitter
        if (Math.abs(delta) < 1) update._depth = targetDepth; else update._depth += delta * 0.18;
      }
      const shown = Math.max(0, Math.round(update._depth));
      navDepthCounter.textContent = shown === 0 ? '0m' : `- ${shown}m`;
    }

    // --- Process spheres animation ---
    (function animateProcess(){
      const frame = document.getElementById('processFrame');
      if (!frame) return;
      const r = frame.getBoundingClientRect();
      const s = textPanel.getBoundingClientRect();
      // progress relative to the top of first animation (enter -> exit of frame)
      let p = 1 - clamp((r.top - s.top) / s.height, 0, 1); // 0..1 in view
      // drive emergence only after top reaches panel top; reverse when leaving
      // map 0..1 to -0.2..1.2 for gentle ease near edges
      p = clamp(p, 0, 1);

      const W = r.width, H = r.height;
      const y = H * 0.5 - 36; // center vertically (72px spheres)
      // start all spheres from left origin (x0)
      const x0 = Math.round(W * 0.08);
      // target centers at equal thirds
      const c1 = W * (1/6);
      const c2 = W * 0.5;
      const c3 = W * (5/6);
      // increase spacing by 30% from the middle
      const SPREAD = 1.3;
      const c1e = c2 + (c1 - c2) * SPREAD;
      const c3e = c2 + (c3 - c2) * SPREAD;
      // convert to top-left (subtract radius 36) and clamp into frame
      const clampTL = (x) => Math.max(0, Math.min(W - 72, Math.round(x - 36)));
      const x1 = clampTL(c1e);
      const x2 = clampTL(c2);
      const x3 = clampTL(c3e);

      const s1 = document.getElementById('sphere1');
      const s2 = document.getElementById('sphere2');
      const s3 = document.getElementById('sphere3');
      if (!(s1 && s2 && s3)) return;

      // simple ease (smoothstep)
      const ease = v => v*v*(3-2*v);
      const e = ease(p);

      const t1 = x0 + (x1 - x0) * e;
      const t2 = x0 + (x2 - x0) * e;
      const t3 = x0 + (x3 - x0) * e;

      s1.style.transform = `translate(${t1}px, ${y}px)`;
      s2.style.transform = `translate(${t2}px, ${y}px)`;
      s3.style.transform = `translate(${t3}px, ${y}px)`;

      // subtle scale in on entry
      const sc = 0.85 + 0.15 * e;
      s1.style.scale = sc; s2.style.scale = sc; s3.style.scale = sc;
      // fade from 0 to 1 across progress
      const a = e;
      s1.style.opacity = a; s2.style.opacity = a; s3.style.opacity = a;

      // loop animation removed
    })();

    // --- Ring of circles rollout (top -> right -> bottom -> left) with stroke follow ---
    (function animateRing(){
      const frame = document.getElementById('ringFrame');
      const ring = document.getElementById('ringPath');
      const nodesWrap = document.getElementById('ringNodes');
      const topEl = document.getElementById('ringTop');
      const rightEl = document.getElementById('ringRight');
      const bottomEl = document.getElementById('ringBottom');
      const leftEl = document.getElementById('ringLeft');
      if (!frame || !ring || !nodesWrap || !topEl || !rightEl || !bottomEl || !leftEl) return;
      const fr = frame.getBoundingClientRect();
      const sr = textPanel.getBoundingClientRect();
      let p = 1 - clamp((fr.top - sr.top) / sr.height, 0, 1); // 0..1
      p = clamp(p, 0, 1);

      const W = fr.width, H = fr.height;
      const cx = W * 0.5, cy = H * 0.5, R = Math.min(W,H) * 0.34;
      const pos = (ang)=> ({ x: cx + R * Math.cos(ang), y: cy + R * Math.sin(ang) });
      const top = pos(-Math.PI/2), right = pos(0), bottom = pos(Math.PI/2), left = pos(Math.PI);
      const place = (el, pt)=> { el.style.transform = `translate(${Math.round(pt.x-32)}px, ${Math.round(pt.y-32)}px)`; };
      place(topEl, top); place(rightEl, right); place(bottomEl, bottom); place(leftEl, left);

      // remove animation: always show nodes at full opacity and scale
      [topEl, rightEl, bottomEl, leftEl].forEach((el)=>{
        el.style.opacity = '1';
        el.style.scale = '1';
      });
    })();

    // Blur removed

    // Footer reveal at end of text with longer damping
    const atEnd = t >= 0.99; // Changed from 1 to 0.99 to account for rounding issues
    console.log('Footer debug - t:', t, 'atEnd:', atEnd, 'scrollTop:', textPanel.scrollTop, 'textMax:', textMax);
    if (footer) {
      if (atEnd) {
        // cancel any pending hide
        if (footerHideTimer) { clearTimeout(footerHideTimer); footerHideTimer = null; }
        if (!footerIsShown && !footerRevealTimer) {
          footerRevealTimer = setTimeout(() => {
            footer.classList.add('show');
            footerIsShown = true;
            footerRevealTimer = null;
            if (typeof stopAuto === 'function' && typeof playRaf !== 'undefined' && playRaf) {
              stopAuto();
            }
          }, 1200); // longer damp delay to allow reading Module 06
        }
      } else {
        // cancel any pending reveal
        if (footerRevealTimer) { clearTimeout(footerRevealTimer); footerRevealTimer = null; }
        if (footerIsShown && !footerHideTimer) {
          footerHideTimer = setTimeout(() => {
            footer.classList.remove('show');
            footerIsShown = false;
            footerHideTimer = null;
          }, 120);
        }
      }
    }

    // Clean left-to-right rollout for thumbnails, tied to video top; reversible
    (function rolloutThumbs(){
      const vf = document.querySelector('.video-frame');
      const row = vf ? vf.nextElementSibling : null;
      if (!vf || !row || !row.classList.contains('thumb-row')) return;
      const vr = vf.getBoundingClientRect();
      const sr = textPanel.getBoundingClientRect();
      // progress anchored to when video top hits panel top (0..1)
      let p = 1 - clamp((vr.top - sr.top) / sr.height, 0, 1);
      p = clamp(p, 0, 1);
      const ease = (v)=> v*v*(3-2*v);
      const e = ease(p);
      const wrappers = Array.from(row.children);
      const boxes = wrappers.map(w => w.querySelector('.small-image-box'));
      const thresholds = [0, 1/3, 2/3];
      boxes.forEach((box, i) => {
        const start = thresholds[i] || 0;
        const local = clamp((e - start) * 3, 0, 1); // map [start..start+1/3] -> [0..1]
        box.style.opacity = local;
        box.style.transform = `translateX(${Math.round((1-local)*20)}px)`;
        const cap = wrappers[i].querySelector('.small-caption');
        if (cap) cap.style.opacity = local;
      });
    })();
  }

  // Keep rAF smoothness without heavy work in the scroll handler
  let ticking = false;
  function onTextScroll() {
    if (!ticking) {
      requestAnimationFrame(() => { update(); ticking = false; });
      ticking = true;
    }
  }

  function isInsideTextPanel(el) {
    return textPanel && textPanel.contains(el);
  }

  function globalWheelRouter(e) {
    if (!isInsideTextPanel(e.target)) {
      e.preventDefault();
      textPanel.scrollBy({ top: e.deltaY, behavior: 'auto' });
    }
    // if inside the panel, let native scrolling happen
  }

  textPanel.addEventListener('scroll', onTextScroll, { passive: true });
  window.addEventListener('resize', () => {
    // Invalidate cache on resize
    cachedHeroH = null;
    cachedBgMax = null;
    requestAnimationFrame(update);
  });
  window.addEventListener('load',   () => requestAnimationFrame(update));

  if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(() => requestAnimationFrame(update));
  }

  // Simple scroll-reveal using IntersectionObserver inside textPanel
  (function initScrollReveal(){
    const items = Array.from(textPanel.querySelectorAll('.sr'));
    if (items.length === 0) return;
    const rootMargin = '0px 0px -10% 0px';
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('revealed');
        } else {
          e.target.classList.remove('revealed');
        }
      });
    }, { root: textPanel, threshold: 0.12, rootMargin });
    // Stagger paragraphs by sentence (non-destructive; fallback to whole paragraph if split fails)
    items.forEach(el => {
      if (el.matches('.section-body')) {
        // Ensure the paragraph remains a single block; don't rewrite inner HTML
        el.style.setProperty('--sr-delay', '0s');
      }
      io.observe(el);
    });
  })();

  // Performance optimization: Use passive listeners for better scroll performance
  // Only intercept when necessary (mobile touch routing)
  if (window.innerWidth <= 768) {
    window.addEventListener('touchstart', onTouchStart, { passive: false });
    window.addEventListener('touchmove',  onTouchMove,  { passive: false });
  }
  // Desktop: let browser handle wheel events natively for better performance
  window.addEventListener('wheel', globalWheelRouter, { passive: true });

  new ResizeObserver(() => requestAnimationFrame(update)).observe(textPanel);

  // Touch routing for mobile (gesture anywhere to scroll the text panel)
  let touchRouting = { active: false, y: 0 };
  function onTouchStart(e) {
    touchRouting.active = !isInsideTextPanel(e.target);
    touchRouting.y = e.touches[0].clientY;
  }
  function onTouchMove(e) {
    if (!touchRouting.active) return; // native inside the panel
    e.preventDefault();
    const dy = touchRouting.y - e.touches[0].clientY;
    textPanel.scrollBy({ top: dy, behavior: 'auto' });
    touchRouting.y = e.touches[0].clientY;
  }

  // --- Simple nav player: set track title and mute toggle ---
  (function initNavPlayer(){
    const muteBtn = document.getElementById('navMuteBtn');
    const titleEl = document.getElementById('navTrackTitle');
    if (!muteBtn || !titleEl) return;
    // Optional: if there is an <audio> element on page, we can reflect its metadata
    const audioEl = document.querySelector('audio');
    if (audioEl) {
      if (audioEl.getAttribute('data-title')) {
        titleEl.textContent = audioEl.getAttribute('data-title');
      }
      audioEl.addEventListener('loadedmetadata', () => {
        if (audioEl.getAttribute('data-title')) titleEl.textContent = audioEl.getAttribute('data-title');
      });
    }
    function setMuted(m){
      // Mute any audio/video elements on the page
      document.querySelectorAll('audio, video').forEach(el => { el.muted = m; });
      muteBtn.textContent = m ? 'Unmute' : 'Mute';
      muteBtn.setAttribute('aria-pressed', String(m));
    }
    // Initialize
    setMuted(true);
    muteBtn.addEventListener('click', () => {
      const isPressed = muteBtn.getAttribute('aria-pressed') === 'true';
      setMuted(!isPressed);
    });
  })();

  // --- Helsinki clock on header cube (Europe/Helsinki) ---
  (function initHelsinkiClock(){
    const el = document.getElementById('helsinkiClock');
    if (!el) return;
    function fmt(){
      const now = new Date();
      // Use Intl to format time in Helsinki, 24h HH:mm:ss
      const str = new Intl.DateTimeFormat('en-GB', {
        timeZone: 'Europe/Helsinki',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false
      }).format(now);
      el.textContent = str;
    }
    fmt();
    setInterval(fmt, 1000);
  })();

  // Module popup handlers
  function initModulePopups(){
    // Ensure popups are positioned relative to the module, not the transformed inner
    document.querySelectorAll('.module-popup').forEach(popup => {
      const section = popup.closest('.section');
      if (section && popup.parentElement !== section) {
        section.appendChild(popup); // reparent to avoid transform containment on .section-inner
      }
    });
    document.querySelectorAll('.module-popup-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const mod = btn.getAttribute('data-module');
        const section = btn.closest('.section');
        const popup = section ? section.querySelector(`.module-popup[data-module="${mod}"]`) : document.querySelector(`.module-popup[data-module="${mod}"]`);
        if (!popup) return;
        const isOpen = popup.classList.contains('show');
        if (isOpen){
          popup.classList.remove('show');
          popup.setAttribute('aria-hidden', 'true');
          btn.textContent = '[Click to view]';
          btn.classList.remove('active');
          const sectionEl = btn.closest('.section');
          if (sectionEl) {
            sectionEl.classList.remove('blur-text');
            // Restore opacity to text elements
            const titleEl = sectionEl.querySelector('.section-title');
            const bodyEl = sectionEl.querySelector('.section-body');
            if (titleEl) titleEl.style.opacity = '';
            if (bodyEl) bodyEl.style.opacity = '';
          }
        } else {
          popup.classList.add('show');
          popup.setAttribute('aria-hidden', 'false');
          btn.textContent = '[Click to hide]';
          btn.classList.add('active');
          const sectionEl = btn.closest('.section');
          if (sectionEl) {
            sectionEl.classList.add('blur-text');
            // Instead of adding blur-text to the entire section, target specific elements
            const titleEl = sectionEl.querySelector('.section-title');
            const bodyEl = sectionEl.querySelector('.section-body');
            if (titleEl) titleEl.style.opacity = '0';
            if (bodyEl) bodyEl.style.opacity = '0';
          }
        }
      });
    });
    document.querySelectorAll('.module-popup').forEach(popup => {
      popup.addEventListener('click', (e) => {
        if (e.target === popup || e.target.classList.contains('popup-backdrop')){
          popup.classList.remove('show');
          popup.setAttribute('aria-hidden', 'true');
          const mod = popup.getAttribute('data-module');
          const section = popup.closest('.section');
          const btn = section ? section.querySelector(`.module-popup-btn[data-module="${mod}"]`) : document.querySelector(`.module-popup-btn[data-module="${mod}"]`);
          if (btn) {
            btn.textContent = '[Click to view]';
            btn.classList.remove('active');
          }
          if (section) {
            section.classList.remove('blur-text');
            // Restore opacity to text elements
            const titleEl = section.querySelector('.section-title');
            const bodyEl = section.querySelector('.section-body');
            if (titleEl) titleEl.style.opacity = '';
            if (bodyEl) bodyEl.style.opacity = '';
          }
        }
      });
    });
  }

  // Mount the existing cube into the framed square in section-01
  // Toggle cube visibility from intro button
  function initToggleCube(){
    const btn = document.getElementById('toggleCubeBtn');
    const square = document.querySelector('.intro-square');
    const title = document.querySelector('.intro-copy .intro-text');
    const subtext = document.getElementById('introSubtext');
    if (!btn || !square) { return; }
    // Prepare subtext words on first run
    const subtextString = 'Or process and intention meets outcome and optimisation. Or creativity enhanced through a continuous loop of learning and development.';
    let subtextPrepared = false;
    function prepareSubtext(){
      if (subtextPrepared || !subtext) return;
      const words = subtextString.split(/(\s+)/); // keep spaces
      let isSecondSentence = false;
      
      subtext.innerHTML = words.map((w, i) => {
        if (w.trim().length === 0) return w; // space
        
        // Check if we're in the second sentence (after the first period)
        if (w.includes('.')) {
          // Only switch to second sentence after we've processed the period
          if (!isSecondSentence) {
            isSecondSentence = true;
            return `<span class=\"word\" style=\"transition: opacity 420ms cubic-bezier(0.2, 0.6, 0.15, 1) ${i*42}ms, transform 420ms cubic-bezier(0.2, 0.6, 0.15, 1) ${i*42}ms;\">${w}</span>`;
          }
        }
        
        const fontStyle = isSecondSentence ? "font-family: 'Minion Pro', serif; font-style: italic;" : '';
        return `<span class=\"word\" style=\"transition: opacity 420ms cubic-bezier(0.2, 0.6, 0.15, 1) ${i*42}ms, transform 420ms cubic-bezier(0.2, 0.6, 0.15, 1) ${i*42}ms; ${fontStyle}\">${w}</span>`;
      }).join('');
      subtextPrepared = true;
    }
    function refreshLabel(){ 
      btn.textContent = square.classList.contains('hidden') ? 'Show cube' : 'Hide cube'; 
    }

    function alignSubtextToTitle(){
      if (!title || !subtext) return;
      const titleRect = title.getBoundingClientRect();
      const containerRect = document.querySelector('.section-01')?.getBoundingClientRect();
      if (!containerRect) return;
      const leftOffset = Math.max(0, titleRect.left - containerRect.left);
      subtext.style.left = `${leftOffset}px`;
      subtext.style.right = `${Math.max(0, containerRect.right - titleRect.right)}px`;
    }
    btn.addEventListener('click', (e) => { 
      e.preventDefault();
      e.stopPropagation();
      // If showing cube -> reverse animation then fade in cube after
      if (square.classList.contains('hidden')){
        // Reverse: hide subtext, move title back down, then show cube
        if (title) title.classList.remove('up');
        alignSubtextToTitle();
        if (subtext){
          const words = subtext.querySelectorAll('.word');
          words.forEach(el => { el.style.opacity = '0'; el.style.transform = 'translateY(8px)'; });
          subtext.classList.remove('revealed');
        }
        // Wait for text to settle, then fade in cube
        setTimeout(() => {
          square.classList.remove('hidden');
          refreshLabel();
        }, 460);
      } else {
        // Hiding cube -> fade cube, lift title, then reveal subtext
        prepareSubtext();
        // start cube fade immediately
        square.classList.add('hidden');
        if (title) title.classList.add('up');
        alignSubtextToTitle();
        // then reveal subtext slightly after title starts moving
        setTimeout(() => {
          if (subtext){
            subtext.classList.add('revealed');
            const words = subtext.querySelectorAll('.word');
            words.forEach(el => { el.style.opacity = '1'; el.style.transform = 'translateY(0)'; });
          }
          refreshLabel();
        }, 220);
      }

    // Align on load and on resize
    alignSubtextToTitle();
    window.addEventListener('resize', alignSubtextToTitle);
    });
    refreshLabel();
  }
  
  // Initialize when DOM is ready and after cube mounting
  function initAll() {
    initToggleCube();
    
    // (removed temporary debug listener)
    initModulePopups();

    // Ensure About anchors scroll the internal text panel to the footer panel
    const aboutLink = document.querySelector('.intro-actions-bottom a[href="#footerPanel"]');
    function scrollPanelToFooter(e){
      if (e) e.preventDefault();
      const container = document.querySelector('.text-panel');
      const target = document.getElementById('footerPanel');
      if (container){
        if (target && container.contains(target)){
          const containerRect = container.getBoundingClientRect();
          const targetRect = target.getBoundingClientRect();
          const top = targetRect.top - containerRect.top + container.scrollTop;
          container.scrollTo({ top, behavior: 'smooth' });
          if (!target.hasAttribute('tabindex')) target.setAttribute('tabindex','-1');
          setTimeout(() => { try { target.focus({ preventScroll: true }); } catch(_) {} }, 300);
        } else {
          // Footer is outside the scroll panel; scroll the panel to its bottom
          const top = container.scrollHeight - container.clientHeight;
          container.scrollTo({ top, behavior: 'smooth' });
        }
        // Update hash without jumping
        if (history && history.replaceState) history.replaceState(null, '', '#footerPanel');
      } else if (target) {
        // No internal panel; fall back to page scroll
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        if (!target.hasAttribute('tabindex')) target.setAttribute('tabindex','-1');
        setTimeout(() => { try { target.focus({ preventScroll: true }); } catch(_) {} }, 300);
      }
    }
    if (aboutLink){ aboutLink.addEventListener('click', scrollPanelToFooter); }

    // Back to top: scroll the text panel to the very top smoothly
    const backToTop = document.getElementById('backToTopBtn');
    if (backToTop){
      backToTop.addEventListener('click', (e) => {
        e.preventDefault();
        const container = document.querySelector('.text-panel');
        if (container){ container.scrollTo({ top: 0, behavior: 'smooth' }); }
        else { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        if (history && history.replaceState) history.replaceState(null, '', '#');
      });
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAll);
  } else {
    initAll();
  }
  document.addEventListener('DOMContentLoaded', () => {
    const mount = document.getElementById('cubeMount');
    const cubeEl = document.querySelector('.text-panel .cube-block') || document.querySelector('#cubeStash .cube-block');
    if (mount && cubeEl && !mount.contains(cubeEl)) {
      mount.appendChild(cubeEl);
      cubeEl.style.width = '100%';
      cubeEl.style.height = '100%';
    }
  });

  // --- Initialize hero copy (word-by-word rollout) ---
  (function initHeroCopy(){
    const el = document.getElementById('heroIntroText');
    if (!el) return;
    const text = 'Full stack creative using AI integration to produce modern perspectives on the image, text, communications strategy, and sound. Based between London, Milan, and Helsinki.';
    const words = text.split(/\s+/);
    const frag = document.createDocumentFragment();
    const STAGGER = 0.10; // faster stagger (50% faster rollout)
    words.forEach((w, i) => {
      const span = document.createElement('span');
      span.className = 'hero-word';
      span.style.setProperty('--d', (i * STAGGER) + 's');
      span.textContent = w;
      frag.appendChild(span);
      if (i !== words.length - 1) frag.appendChild(document.createTextNode(' '));
    });
    el.textContent = '';
    el.appendChild(frag);
  })();

  // TV wall removed
  // --- Code typing animation ---
  (function initCodeTyping(){
    const el = document.getElementById('codeScreen');
    if (!el) return;
    // Generate ~100 lines of pseudo-code from site snippets
    const base = [
      "// HUD configuration",
      "const HUD_STROKE = 1;",
      "const COLOR_GREEN = 'rgb(0,255,0)';",
      "function clamp(v,min,max){ return Math.min(max, Math.max(min, v)); }",
      "function lerp(a,b,t){ return a + (b-a)*t; }",
      "",
      "// Initialize movers",
      "const movers = Array.from({length:8}).map((_,i)=>({",
      "  x: Math.random(), y: Math.random(),",
      "  vx: (Math.random()*2-1)*0.056,",
      "  vy: (Math.random()*2-1)*0.056",
      "}));",
      "",
      "// Animation frame",
      "function frame(time){",
      "  for(const m of movers){",
      "    m.x = clamp(m.x + m.vx*0.016, 0, 1);",
      "    m.y = clamp(m.y + m.vy*0.016, 0, 1);",
      "  }",
      "  requestAnimationFrame(frame);",
      "}",
      "frame(performance.now());"
    ];
    const lines = [];
    while (lines.length < 100) lines.push(...base);
    lines.length = 100;

    let i = 0, j = 0, text = '';
    function typeNext(){
      if (i >= lines.length) { i = 0; j = 0; text = ''; el.textContent = ''; }
      const s = lines[i] + "\n";
      text += s[j++];
      el.textContent = text + (j % 2 ? '_' : '');
      // keep the latest line in view
      el.scrollTop = el.scrollHeight;
      if (j >= s.length) { i++; j = 0; setTimeout(typeNext, 120); return; }
      setTimeout(typeNext, 18); // typing speed per char
    }
    typeNext();
  })();
  // Flow process animation and connectors
  (function initFlow(){
    const row = document.getElementById('flowRow');
    if (!row) return;
    const boxes = Array.from(row.querySelectorAll('.flow-box'));
    const svg = row.parentElement.querySelector('.flow-lines');

    function render(){
      if (!svg) return;
      const bb = boxes.map(b => b.getBoundingClientRect());
      const fr = row.getBoundingClientRect();
      const toPct = (v, max) => (v / max) * 100;
      svg.setAttribute('viewBox','0 0 100 100');
      svg.innerHTML = '';
      for (let i=0;i<bb.length-1;i++){
        const a = bb[i], b = bb[i+1];
        const ax = a.right - fr.left, ay = a.top + a.height/2 - fr.top;
        const bx = b.left - fr.left,  by = b.top + b.height/2 - fr.top;
        const mx = (ax + bx) / 2;
        const d = `M ${toPct(ax, fr.width)},${toPct(ay, fr.height)} C ${toPct(mx, fr.width)},${toPct(ay, fr.height)} ${toPct(mx, fr.width)},${toPct(by, fr.height)} ${toPct(bx, fr.width)},${toPct(by, fr.height)}`;
        const path = document.createElementNS('http://www.w3.org/2000/svg','path');
        path.setAttribute('d', d);
        path.setAttribute('marker-end','url(#arrow)');
        svg.appendChild(path);
      }
      // Define arrow marker once
      if (!svg.querySelector('defs')){
        const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
        const marker = document.createElementNS('http://www.w3.org/2000/svg','marker');
        marker.setAttribute('id','arrow');
        marker.setAttribute('viewBox','0 0 10 10');
        marker.setAttribute('refX','10');
        marker.setAttribute('refY','5');
        marker.setAttribute('markerWidth','6');
        marker.setAttribute('markerHeight','6');
        marker.setAttribute('orient','auto');
        const tip = document.createElementNS('http://www.w3.org/2000/svg','path');
        tip.setAttribute('d','M 0 0 L 10 5 L 0 10 z');
        tip.setAttribute('fill','#333');
        marker.appendChild(tip);
        defs.appendChild(marker);
        svg.prepend(defs);
      }
    }

    function updateFlow(){
      const sr = textPanel.getBoundingClientRect();
      const fr = row.parentElement.getBoundingClientRect();
      let p = 1 - Math.min(1, Math.max(0, (fr.top - sr.top)/sr.height));
      const thresholds = [0, .2, .4, .6];
      boxes.forEach((b, i)=>{
        const local = Math.max(0, Math.min(1, (p - thresholds[i]) * 5));
        b.style.opacity = String(local);
        b.style.transform = `translateX(${Math.round((1-local)*16)}px)`;
      });
      render();
    }

    new ResizeObserver(updateFlow).observe(row);
    textPanel.addEventListener('scroll', updateFlow, { passive: true });
    window.addEventListener('resize', updateFlow);
    window.addEventListener('load', updateFlow);
    updateFlow();
  })();
  // Resolve thumbnail fallbacks if primary paths fail
  (function resolveThumbs(){
    const attempts = [
      { id: 'thumbNE003' },
      { id: 'thumbNE002' },
      { id: 'thumbVOCE' }
    ];
    attempts.forEach(({id})=>{
      const img = document.getElementById(id);
      if (!img) return;
      const candidates = (img.getAttribute('data-fallbacks')||'').split(',').map(s=>s.trim()).filter(Boolean);
      let i = 0;
      function tryNext(){
        if (i >= candidates.length) return;
        img.src = candidates[i++];
      }
      img.addEventListener('error', tryNext);
      tryNext();
    });
  })();
  // --- HUD demo animation ---
  (function initHud(){
    const slot = document.querySelector('.hud-slot');
    if (!slot) return;
    const imgs = document.getElementById('hudImgs');
    const micro = document.getElementById('hudMicro');
    const overlay = document.getElementById('hudOverlay');
    const sources = [
      'assets/images/grid 1/cRXKvV.png',
      'assets/images/grid 1/enJIbX.png',
      'assets/images/grid 1/eO4SnI.png',
      'assets/images/grid 1/k2UkPc.png',
      'assets/images/grid 1/K8ayJ5.png',
      'assets/images/grid 1/LRNiuu.png',
      'assets/images/grid 1/MXVl6v.png',
      'assets/images/grid 1/n0Lajj.png',
      'assets/images/grid 1/NO7cDY.png',
      'assets/images/grid 1/s12ks0.png',
      'assets/images/grid 1/TSxc3W.png',
      'assets/images/grid 1/uJAfnB.png'
    ];

    const cells = 8; // number of moving images
    const movers = [];
    for (let i = 0; i < cells; i++) {
      const img = document.createElement('img');
      img.src = sources[i % sources.length];
      img.alt = 'hud img';
      img.style.width = '38%';
      img.style.height = 'auto';
      img.style.opacity = '0.9';
      imgs.appendChild(img);
      const m = {
        el: img,
        x: Math.random(), y: Math.random(),
        vx: (Math.random()*2-1) * 0.056, // 30% slower than original 0.08
        vy: (Math.random()*2-1) * 0.056,
        fade: Math.random()*Math.PI*2,
      };
      movers.push(m);
    }

    const rects = [
      { el: makeRect(), w: .22, h: .22, s: 0 },
      { el: makeRect(), w: .20, h: .20, s: 0 },
      { el: makeRect(), w: .16, h: .16, s: 0 },
    ];

    // micro sprites (unblurred, small, particle-like strobe)
    const micros = [];
    for (let i = 0; i < 12; i++) {
      const spr = document.createElement('img');
      spr.src = sources[i % sources.length];
      spr.alt = 'micro';
      spr.style.width = '12%';
      spr.style.height = '12%';
      spr.style.objectFit = 'cover';
      spr.style.opacity = '0';
      spr.style.position = 'absolute';
      micro.appendChild(spr);
      micros.push({ el: spr, t: Math.random()*5 });
    }

    function makeRect(){
      const r = document.createElement('div');
      r.className = 'hud-rect';
      const label = document.createElement('div');
      label.className = 'hud-rect-label';
      label.textContent = '0000';
      r.appendChild(label);
      overlay.appendChild(r);
      return r;
    }

    function randInt(min, max){ return Math.floor(min + Math.random()*(max-min+1)); }

    let last = performance.now();
    function frame(t){
      const dt = Math.min(0.06, (t - last)/1000); last = t;
      const bounds = slot.getBoundingClientRect();
      const W = bounds.width, H = bounds.height;
      // move images
      for (const m of movers) {
        // move and bounce within slot
        m.x += m.vx * dt; m.y += m.vy * dt;
        if (m.x < 0 || m.x > 1) { m.vx *= -1; m.x = Math.max(0, Math.min(1, m.x)); }
        if (m.y < 0 || m.y > 1) { m.vy *= -1; m.y = Math.max(0, Math.min(1, m.y)); }
        const px = m.x * (W - m.el.clientWidth);
        const py = m.y * (H - m.el.clientHeight);
        m.el.style.transform = `translate(${px}px, ${py}px)`;
        // fade in/out to create space
        m.fade += dt * (0.6 + Math.random()*0.4);
        const a = (Math.sin(m.fade) * 0.5 + 0.5); // 0..1
        m.el.style.opacity = (0.25 + 0.75 * a).toFixed(2);
      }
      // track a mover per rect
      rects.forEach((r, i) => {
        const target = movers[(i*3 + Math.floor(t/1000)) % movers.length];
        // size pulse for rectangle
        r.s += dt * (0.6 + i * 0.3);
        const sizeMult = 1 + Math.sin(r.s) * 0.25; // +/-25%
        const rw = r.w * W * sizeMult, rh = r.h * H * sizeMult;
        const tx = (target.x * W) - rw/2;
        const ty = (target.y * H) - rh/2;
        r.el.style.left = Math.round(tx) + 'px';
        r.el.style.top  = Math.round(ty) + 'px';
        r.el.style.width  = Math.round(rw) + 'px';
        r.el.style.height = Math.round(rh) + 'px';
        // update label numeric output
        const lbl = r.el.querySelector('.hud-rect-label');
        if (lbl) {
          lbl.textContent = (Math.round(target.x*1000) + ',' + Math.round(target.y*1000));
        }
      });

      // motion detection lines + axes
      const lines = document.getElementById('hudLines');
      if (lines) {
        const pts = rects.map(r => ({
          x: (parseFloat(r.el.style.left)||0) + (parseFloat(r.el.style.width)||0)/2,
          y: (parseFloat(r.el.style.top)||0)  + (parseFloat(r.el.style.height)||0)/2
        }));
        // build lines: 0-1, 1-2, 2-0
        const w = W, h = H;
        const toUnit = (v, max) => (v / max * 100);
        lines.setAttribute('viewBox', '0 0 100 100');
        lines.innerHTML = '';
        const pairs = [[0,1],[1,2],[2,0]];
        for (const [a,b] of pairs) {
          const ln = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          ln.setAttribute('x1', toUnit(pts[a].x, w));
          ln.setAttribute('y1', toUnit(pts[a].y, h));
          ln.setAttribute('x2', toUnit(pts[b].x, w));
          ln.setAttribute('y2', toUnit(pts[b].y, h));
          lines.appendChild(ln);
        }
        // crosshair axes through primary rect (0)
        const cx = toUnit(pts[0].x, w), cy = toUnit(pts[0].y, h);
        const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        xAxis.setAttribute('class','cross');
        xAxis.setAttribute('x1','0'); xAxis.setAttribute('y1', cy);
        xAxis.setAttribute('x2','100'); xAxis.setAttribute('y2', cy);
        lines.appendChild(xAxis);
        const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        yAxis.setAttribute('class','cross');
        yAxis.setAttribute('x1', cx); yAxis.setAttribute('y1','0');
        yAxis.setAttribute('x2', cx); yAxis.setAttribute('y2','100');
        lines.appendChild(yAxis);
      }

      // numeric labels (time + X/Y)
      const tl = document.getElementById('hudTL');
      const bl = document.getElementById('hudBL');
      const br = document.getElementById('hudBR');
      const n1 = randInt(0,9999).toString().padStart(4,'0');
      const n2 = randInt(200,399);
      const now = new Date();
      const hh = now.getHours().toString().padStart(2,'0');
      const mm = now.getMinutes().toString().padStart(2,'0');
      const ss = now.getSeconds().toString().padStart(2,'0');
      const primary = rects[0];
      const px = ((parseFloat(primary.el.style.left)||0) + (parseFloat(primary.el.style.width)||0)/2) / (slot.getBoundingClientRect().width);
      const py = ((parseFloat(primary.el.style.top)||0)  + (parseFloat(primary.el.style.height)||0)/2) / (slot.getBoundingClientRect().height);
      const xOut = Math.round(px*1000), yOut = Math.round(py*1000);
      tl.textContent = `${hh}:${mm}:${ss} • X:${xOut} Y:${yOut}`;
      bl.textContent = '['+n2+']';
      br.textContent = n1;

      // update micro sprites (strobe pops at random positions without jittering once placed)
      for (const m of micros) {
        m.t -= dt;
        if (m.t <= 0) {
          // re-spawn: random position and short visible burst
          const x = Math.random();
          const y = Math.random();
          const px = x * (W - m.el.clientWidth);
          const py = y * (H - m.el.clientHeight);
          m.el.style.transform = `translate(${px}px, ${py}px)`;
          m.t = (0.25 + Math.random() * 1.25) * 2; // 50% slower (longer between pops)
          // animate opacity burst (harder cut)
          m.el.style.transition = 'opacity 240ms ease-out';
          m.el.style.opacity = '0.9';
          setTimeout(() => { m.el && (m.el.style.opacity = '0'); }, 200 + Math.floor(Math.random()*800));
        }
      }

      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  })();
    </script>
</body>
</html>
